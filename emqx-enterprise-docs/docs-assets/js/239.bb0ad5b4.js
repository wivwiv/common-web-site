(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{1509:function(e,s,a){"use strict";a.r(s);var n=a(10),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"release-upgrade"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#release-upgrade"}},[e._v("#")]),e._v(" Release Upgrade")]),e._v(" "),a("p",[e._v("Since version 4.2.0, EMQX Broker supports hot upgrade.")]),e._v(" "),a("p",[e._v("By using the hot upgrade feature, users can quickly and safely upgrade the EMQX Broker in the production environment, and avoid the decrease in system availability caused by restarting the service.")]),e._v(" "),a("p",[e._v("Currently EMQX Broker only supports hot upgrade of Patch version (Patch version is the third digit of the version number).\nThat is, it currently supports hot upgrades from 4.2.0 -> 4.2.1, 4.2.0 -> 4.2.2, ..., etc., but 4.2.x cannot be hot upgraded to 4.3.0 or 5.0.")]),e._v(" "),a("p",[e._v("Currently, Windows, MacOSX does not support hot upgrade feature.")]),e._v(" "),a("h2",{attrs:{id:"hot-upgrade-steps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hot-upgrade-steps"}},[e._v("#")]),e._v(" Hot upgrade steps")]),e._v(" "),a("ol",[a("li",[e._v("View the currently installed version list of EMQX Broker.")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ emqx versions\n\nInstalled versions:\n* "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0\tpermanent\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Download the software package to be upgraded from the EMQX website.")])]),e._v(" "),a("p",[e._v("Visit https://www.emqx.com/en/downloads?product=broker, Select the corresponding version and operating system type, and then select the "),a("strong",[e._v('"zip"')]),e._v(" package type.")]),e._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Find the installation directory of EMQX:")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("EMQX_ROOT_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("emqx root_dir"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${EMQX_ROOT_DIR}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/usr/lib/emqx"')]),e._v("\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("Put the downloaded zip package in the "),a("code",[e._v("releases")]),e._v(" directory under the EMQX installation directory:")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" emqx-4.2.1.zip "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("${EMQX_ROOT_DIR}")]),e._v("/releases/\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[e._v("Upgrade to the specified version:")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ emqx upgrade "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1\n\nRelease "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1 not found, attempting to unpack releases/emqx-4.2.1.tar.gz\nUnpacked successfully: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"4.2.1"')]),e._v("\nInstalled Release: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1\nMade release permanent: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"4.2.1"')]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("ol",{attrs:{start:"6"}},[a("li",[e._v("Check the version list again, and the status of the previous version will become "),a("code",[e._v("old")]),e._v(":")])]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ emqx versions\n\nInstalled versions:\n* "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1\tpermanent\n* "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0\told\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("h2",{attrs:{id:"manually-permanent-after-upgrade"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manually-permanent-after-upgrade"}},[e._v("#")]),e._v(" Manually permanent after upgrade")]),e._v(" "),a("p",[e._v("The above "),a("code",[e._v("emqx upgrade 4.2.1")]),e._v(" command actually performs three actions:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("unpack")])]),e._v(" "),a("li",[a("code",[e._v("install")])]),e._v(" "),a("li",[a("code",[e._v("permanent")])])]),e._v(" "),a("p",[e._v("After permanent, this version upgrade will be fixed, which means that after the hot upgrade, if emqx restarts, the new version after the upgrade will be used.")]),e._v(" "),a("p",[e._v("If you don't want to persist while upgrading, you can use the "),a("code",[e._v("--no-permanent")]),e._v(" parameter:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ emqx upgrade --no-permanent "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1\n\nRelease "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1 not found, attempting to unpack releases/emqx-4.2.1.tar.gz\nUnpacked successfully: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"4.2.1"')]),e._v("\nInstalled Release: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("p",[e._v("At this time, the version has been successfully upgraded to 4.2.1. However, if you restart emqx, it will revert to the old version 4.2.0.\nNow, if you check the version list, you will find that the state of 4.2.1 is "),a("code",[e._v("current")]),e._v(", not the permanent version:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ emqx versions\n\nInstalled versions:\n* "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1\tcurrent\n* "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0\tpermanent\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("p",[e._v("After the system has been running stably for a period of time, if you decide to make the new version permant, you can execute the "),a("code",[e._v("install")]),e._v(" command again:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ emqx "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1\n\nRelease "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".1 is already installed and current, making permanent.\nMade release permanent: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"4.2.1"')]),e._v("\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("h2",{attrs:{id:"downgrade-to-pervious-versions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#downgrade-to-pervious-versions"}},[e._v("#")]),e._v(" Downgrade to pervious versions")]),e._v(" "),a("p",[e._v("If you find a problem and want to roll back after the upgrade, you can execute the version downgrade command.\nFor example, the following example will roll back emqx to version 4.2.0:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ emqx downgrade "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0\n\nRelease "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0 is marked old, switching to it.\nInstalled Release: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0\nMade release permanent: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"4.2.0"')]),e._v("\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("h2",{attrs:{id:"delete-versions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#delete-versions"}},[e._v("#")]),e._v(" Delete versions")]),e._v(" "),a("p",[e._v("After the system has been running stably for a period of time, if you decide to delete an old version, you can execute the version uninstall command.\nFor example, the following example will uninstall the old version 4.2.0:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n$ emqx uninstall "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0\n\nRelease "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0 is marked old, uninstalling it.\nUninstalled Release: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.2")]),e._v(".0\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);