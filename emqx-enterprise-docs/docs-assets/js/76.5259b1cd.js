(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{1613:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"save-data-to-timescaledb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#save-data-to-timescaledb"}},[s._v("#")]),s._v(" Save data to TimescaleDB")]),s._v(" "),e("p",[s._v("Setup a TimescaleDB database, taking Mac OSX for instance:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ docker pull timescale/timescaledb\n\n$ docker run -d --name timescaledb -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v(":5432 -e "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("POSTGRES_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password timescale/timescaledb:latest-pg11\n\n$ docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it timescaledb psql -U postgres\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## create tutorial database")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CREATE database tutorial"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("c tutorial\n\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CREATE EXTENSION IF NOT EXISTS timescaledb CASCADE"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("Initiate the TimescaleDB table:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it timescaledb psql -U postgres -d tutorial\n\nCREATE TABLE conditions "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("        TIMESTAMPTZ       NOT NULL,\n    location    TEXT              NOT NULL,\n    temperature DOUBLE PRECISION  NULL,\n    humidity    DOUBLE PRECISION  NULL\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nSELECT create_hypertable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'conditions'")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'time'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("Create a rule:")]),s._v(" "),e("p",[s._v("Go to "),e("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[s._v("EMQX Dashboard"),e("OutboundLink")],1),s._v(', select the\n"rule" tab on the menu to the left.')]),s._v(" "),e("p",[s._v('Select "message.publish", then type in the following SQL:')]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n    payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temp")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temp")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("humidity "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" humidity"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" location\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message.publish"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("img",{attrs:{src:a(750),alt:"image"}})]),s._v(" "),e("p",[s._v("Bind an action:")]),s._v(" "),e("p",[s._v('Click on the "+ Add" button under "Action Handler", and then select\n"Data to TimescaleDB" in the pop-up dialog window.')]),s._v(" "),e("p",[e("img",{attrs:{src:a(751),alt:"image"}})]),s._v(" "),e("p",[s._v("Fill in the parameters required by the action:")]),s._v(" "),e("p",[s._v('Two parameters is required by action "Data to TimescaleDB":')]),s._v(" "),e("p",[s._v("1). SQL template. SQL template is the sql command you'd like to run\nwhen the action is triggered. In this example we'll insert a message\ninto timescaledb, so type in the following sql\ntemplate:")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" conditions"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("time")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" location"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" temperature"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" humidity"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("NOW")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${location}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temp")]),s._v("}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${humidity}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Before data is inserted into the table, placeholders like ${key} will\nbe replaced by the corresponding values.")]),s._v(" "),e("p",[e("img",{attrs:{src:a(445),alt:"image"}})]),s._v(" "),e("p",[s._v('2). Bind a resource to the action. Since the dropdown list "Resource"\nis empty for now, we create a new resource by clicking on the "New\nResource" to the top right, and then select "TimescaleDB":')]),s._v(" "),e("p",[e("img",{attrs:{src:a(445),alt:"image"}})]),s._v(" "),e("p",[s._v("Configure the resource:")]),s._v(" "),e("p",[s._v('Set "TimescaleDB Database" to "tutorial", "TimescaleDB User" to\n"postgres", "TimescaleDB Password" to "password", and keep all other\nconfigs as default, and click on the "Testing Connection" button to\nmake sure the connection can be created successfully, and then click\non the "Create" button.')]),s._v(" "),e("p",[e("img",{attrs:{src:a(752),alt:"image"}})]),s._v(" "),e("p",[s._v('Back to the "Actions" dialog, and then click on the "Confirm" button.')]),s._v(" "),e("p",[e("img",{attrs:{src:a(753),alt:"image"}})]),s._v(" "),e("p",[s._v('Back to the creating rule page, then click on "Create" button. The\nrule we created will be show in the rule list:')]),s._v(" "),e("p",[e("img",{attrs:{src:a(754),alt:"image"}})]),s._v(" "),e("p",[s._v("We have finished, testing the rule by sending an MQTT message to\nemqx:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Topic: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t/1"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" QoS: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Retained: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Payload: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"temp"')]),s._v(":24,"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"humidity"')]),s._v(":30,"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"location"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hangzhou"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("Then inspect the TimescaleDB table, verify a new record has been\ninserted:")]),s._v(" "),e("p",[s._v("tutorial=# SELECT * FROM conditions LIMIT 100;")]),s._v(" "),e("p",[s._v("The output data could look like")]),s._v(" "),e("p",[s._v("this:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("    "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("              "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" location "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" temperature "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" humidity\n\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("------------------------------+----------+-------------+----------2019-06-27\n 01:41:08.752103+00 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" hangzhou "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v('And from the rule list, verify that the "Matched" column has increased\nto 1:')]),s._v(" "),e("p",[e("img",{attrs:{src:a(755),alt:"image"}})])])}),[],!1,null,null,null);t.default=n.exports},445:function(s,t,a){s.exports=a.p+"docs-assets/img/timescaledb_action_1.86714f37.png"},750:function(s,t,a){s.exports=a.p+"docs-assets/img/timescaledb_sql_1.9b71c154.png"},751:function(s,t,a){s.exports=a.p+"docs-assets/img/timescaledb_action_0.bfad7aac.png"},752:function(s,t,a){s.exports=a.p+"docs-assets/img/timescaledb_resource_0.37f61ff8.png"},753:function(s,t,a){s.exports=a.p+"docs-assets/img/timescaledb_action_3.d252264a.png"},754:function(s,t,a){s.exports=a.p+"docs-assets/img/timescaledb_rule_overview_0.4c198928.png"},755:function(s,t,a){s.exports=a.p+"docs-assets/img/timescaledb_rule_overview_1.b20c9a5b.png"}}]);