(window.webpackJsonp=window.webpackJsonp||[]).push([[288],{1565:function(e,a,t){"use strict";t.r(a);var s=t(10),l=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"log-trace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-trace"}},[e._v("#")]),e._v(" Log & Trace")]),e._v(" "),t("h2",{attrs:{id:"control-log-output"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#control-log-output"}},[e._v("#")]),e._v(" Control log output")]),e._v(" "),t("p",[e._v("EMQX Broker supports log output to the console or log file, or both, which can be configured in "),t("code",[e._v("emqx.conf")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("log.to = file\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("The default value of "),t("code",[e._v("log.to")]),e._v(" is "),t("code",[e._v("file")]),e._v(", which has the following optional values:")]),e._v(" "),t("ul",[t("li",[t("p",[t("strong",[e._v("off:")]),e._v(" Disable log function completely")])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("file:")]),e._v(" Only output log to file")])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("console:")]),e._v(" Only output logs to emqx console")])]),e._v(" "),t("li",[t("p",[t("strong",[e._v("both:")]),e._v(" Both output logs to emqx console and output log to file")])])]),e._v(" "),t("p",[e._v("Starting from version 4.3.0, if you deploy EMQX using Docker, you can only view EMQX logs through the "),t("code",[e._v("docker logs")]),e._v(" command by default. To continue viewing the log file, you can set the environment variable "),t("code",[e._v("EMQX_LOG__TO")]),e._v(" to "),t("code",[e._v("file")]),e._v(" or "),t("code",[e._v("both")]),e._v(" when starting the container.")]),e._v(" "),t("h2",{attrs:{id:"log-level"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-level"}},[e._v("#")]),e._v(" Log level")]),e._v(" "),t("p",[e._v("The log of EMQX Broker is divided into 8 levels ("),t("a",{attrs:{href:"https://www.ietf.org/rfc/rfc5424.txt",target:"_blank",rel:"noopener noreferrer"}},[e._v("RFC 5424"),t("OutboundLink")],1),e._v("), which are shown from low to high as follows:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("debug "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" info "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" notice "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" warning "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" error "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" critical "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" alert "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v(" emergency\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("The default log level of EMQX Broker is warning, which can be modified in "),t("code",[e._v("emqx.conf")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("log.level "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" warning\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("This configuration sets all log handler level to warning.")]),e._v(" "),t("h2",{attrs:{id:"log-file-and-log-rotation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-file-and-log-rotation"}},[e._v("#")]),e._v(" log file and log rotation")]),e._v(" "),t("p",[e._v("The default log file directory of EMQX Broker is in "),t("code",[e._v("./log")]),e._v(" (zip installation) or "),t("code",[e._v("/var/log/emqx")]),e._v(" (binary installation). It can be configured in "),t("code",[e._v("emqx.conf")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("log.dir "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" log\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("When file logging is enabled (log.to = file or both), there will be the following files in the log directory:")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("emqx.log.N:")]),e._v(" log file prefixed with emqx.log, that contains all the log messages of EMQX Broker, such as "),t("code",[e._v("emqx.log.1")]),e._v(","),t("code",[e._v("emqx.log.2")]),e._v(" ...")]),e._v(" "),t("li",[t("strong",[e._v("emqx.log.siz and emqx.log.idx:")]),e._v(" System files used to record log rotation informationã€‚")]),e._v(" "),t("li",[t("strong",[e._v("run_erl.log:")]),e._v(" The system file used to record startup information when starting EMQX Broker in the background with "),t("code",[e._v("emqx start")]),e._v(".")]),e._v(" "),t("li",[t("strong",[e._v("erlang.log.N:")]),e._v(" log file prefixed with erlang.log, which is a copy file of the console log when EMQX Broker is started in the background with "),t("code",[e._v("emqx start")]),e._v(" , such as "),t("code",[e._v("erlang.log.1")]),e._v(","),t("code",[e._v("erlang.log.2")]),e._v(" ...")])]),e._v(" "),t("p",[e._v("The prefix of the log file can be modified in "),t("code",[e._v("emqx.conf")]),e._v(", the default is"),t("code",[e._v("emqx.log")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("log.file "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" emqx.log\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("EMQX Broker will rotate log files by default when the single log file exceeds 10MB. There can be up to 5 log files: the first log file is emqx.log.1, the second is emqx.log.2, and so on. When the last log file also reaches 10MB, it will be overwritten from the log file with the smallest sequence number. The file size limit and the maximum number of log files can be modified in "),t("code",[e._v("emqx.conf")]),e._v(":")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("log.rotation.size "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" 10MB\nlog.rotation.count "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h2",{attrs:{id:"output-log-file-for-log-level"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#output-log-file-for-log-level"}},[e._v("#")]),e._v(" Output log file for log level")]),e._v(" "),t("p",[e._v("If you want to write logs greater than or equal to a certain level to a separate file, you can configure "),t("code",[e._v("log.<level>.file")]),e._v(" in "),t("code",[e._v("emqx.conf")]),e._v(":")]),e._v(" "),t("p",[e._v("Separately output logs of info and above level  to "),t("code",[e._v("info.log.N")]),e._v(" file:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("log.info.file "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" info.log\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("Separately output logs of error and above level  to "),t("code",[e._v("error.log.N")]),e._v(" file:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("log.error.file "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" error.log\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"log-format"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-format"}},[e._v("#")]),e._v(" Log format")]),e._v(" "),t("p",[e._v("The maximum character length of a single log message can be modified in "),t("code",[e._v("emqx.conf")]),e._v(". If the length exceeds the limit, the log message is truncated and filled with"),t("code",[e._v("...")]),e._v(". The default configuration is not to limit the length:")]),e._v(" "),t("p",[e._v("Set the maximum character length of a single log message to 8192:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("log.chars_limit "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("8192")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("The format of the log message (the fields are separated by spaces):")]),e._v(" "),t("p",[t("strong",[e._v("date time level client_info module_info msg")])]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("date:")]),e._v(" Local data. The format is: YYYY-MM-DD")]),e._v(" "),t("li",[t("strong",[e._v("time:")]),e._v(" Local time, accurate to milliseconds. The format is: hh:mm:ss.ms")]),e._v(" "),t("li",[t("strong",[e._v("level:")]),e._v(" log level, wrapped in brackets. The format is:[Level]")]),e._v(" "),t("li",[t("strong",[e._v("client_info:")]),e._v(" optional field, only exists if this log message is related to a client The format is: ClientId@Peername or ClientId or Peername")]),e._v(" "),t("li",[t("strong",[e._v("module_info:")]),e._v(" optional field, only exists if this log message is related to a module. Its format is:[Module Info]")]),e._v(" "),t("li",[t("strong",[e._v("msg:")]),e._v(" log message content. The format is arbitrary and can contain spaces.")])]),e._v(" "),t("h3",{attrs:{id:"log-message-example-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-message-example-1"}},[e._v("#")]),e._v(" Log message example 1:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("-02-18 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("16")]),e._v(":10:03.872 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("debug"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"mqttjs_9e49354bb3"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v("@127.0.0.1:57105 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("MQTT/WS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" SEND CONNACK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("Q0, R0, D0, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("AckFlags")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ReasonCode")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("The fields in this log message are:")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("date:")]),e._v(" "),t("code",[e._v("2020-02-18")])]),e._v(" "),t("li",[t("strong",[e._v("time:")]),e._v(" "),t("code",[e._v("16:10:03.872")])]),e._v(" "),t("li",[t("strong",[e._v("level:")]),e._v(" "),t("code",[e._v("[debug]")])]),e._v(" "),t("li",[t("strong",[e._v("client_info:")]),e._v(" "),t("code",[e._v('<<"mqttjs_9e49354bb3">>@127.0.0.1:57105')])]),e._v(" "),t("li",[t("strong",[e._v("module_info:")]),e._v(" "),t("code",[e._v("[MQTT/WS]")])]),e._v(" "),t("li",[t("strong",[e._v("msg:")]),e._v(" "),t("code",[e._v("SEND CONNACK(Q0, R0, D0, AckFlags=0, ReasonCode=0)")])])]),e._v(" "),t("h3",{attrs:{id:"log-message-example-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-message-example-2"}},[e._v("#")]),e._v(" Log message example 2:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("-02-18 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("16")]),e._v(":10:08.474 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("warning"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Alarm Handler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" New Alarm: system_memory_high_watermark, Alarm Info: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("The fields in this log message are:")]),e._v(" "),t("ul",[t("li",[t("strong",[e._v("date:")]),e._v(" "),t("code",[e._v("2020-02-18")])]),e._v(" "),t("li",[t("strong",[e._v("time:")]),e._v(" "),t("code",[e._v("16:10:08.474")])]),e._v(" "),t("li",[t("strong",[e._v("level:")]),e._v(" "),t("code",[e._v("[warning]")])]),e._v(" "),t("li",[t("strong",[e._v("module_info:")]),e._v(" "),t("code",[e._v("[Alarm Handler]")])]),e._v(" "),t("li",[t("strong",[e._v("msg:")]),e._v(" "),t("code",[e._v("New Alarm: system_memory_high_watermark, Alarm Info: []")])])]),e._v(" "),t("p",[e._v("Note that in this log message, the client_info field does not exist.")]),e._v(" "),t("h2",{attrs:{id:"log-level-and-log-handlers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-level-and-log-handlers"}},[e._v("#")]),e._v(" log level and log handlers")]),e._v(" "),t("p",[e._v("EMQX Broker uses a hierarchical log system. At the log level, it includes primary log level and the log level of each log hanlder.")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Primary Level"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("        -- global log level and filters\n           / "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Handler "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("Handler "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("    -- log levels and filters at each handler\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("The log handler is the working process responsible for log processing and output. It is uniquely identified by the log handler id and has the following tasks:")]),e._v(" "),t("ul",[t("li",[e._v("What level of logs to receive")]),e._v(" "),t("li",[e._v("How to filter log messages")]),e._v(" "),t("li",[e._v("Where to output logs")])]),e._v(" "),t("p",[e._v("The log handlers installed by default in emqx:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log handlers list\n\nLogHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("ssl_handler, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("debug, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("destination")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nLogHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("file, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("debug, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("destination")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("log/emqx.log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\nLogHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("default, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("debug, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("destination")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("ul",[t("li",[e._v("file: The log handler responsible for output to the log file. There is no special filtering conditions, that is, all log messages are output as long as the level meets the requirements. The output destination is a log file.")]),e._v(" "),t("li",[e._v("default: the log handler responsible for output to the console. There is no special filtering conditions, that is, all log messages are output as long as the level meets the requirements. The output destination is the console.")]),e._v(" "),t("li",[e._v("ssl_handler: ssl's log handler. Its filter condition is set to output when the log is from the ssl module. The output destination is the console.")])]),e._v(" "),t("p",[e._v("Before the log message is output, we should check whether the message level is higher than the primary log level. After passing the check, the log message flows into each log handler. Then, we should check the log level of each handler. If the log message is higher than the handler level, the corresponding handler performs Filter conditions. When it is passed, output is performed.")]),e._v(" "),t("p",[e._v("Imagine a scenario where the primary log level is set to info, the log handler "),t("code",[e._v("default")]),e._v(" is set to debug, and the log handler "),t("code",[e._v("file")]),e._v(" is set to warning:")]),e._v(" "),t("ul",[t("li",[e._v("Although the console log is at the debug level, at this time the console log can only output messages to the level info and above. That is because after the primary level filtering, the logs flowing to the default and file only belong to the level of info and above;")]),e._v(" "),t("li",[e._v("The emqx.log.N file contains log messages at warning and above level .")])]),e._v(" "),t("p",[e._v('The "log.level" mentioned in the  '),t("a",{attrs:{href:"#log-levels"}},[e._v("Log Level")]),e._v(" section is the modified global log level. This includes the primary log level and the log level of each handler, all of which is set to the same value.")]),e._v(" "),t("p",[e._v("Primary Log Level is equivalent to the main switch of a tap water pipe system. Once closed, no water flow will pass through each branch pipe. This mechanism ensures the high-performance operation of the logging system.")]),e._v(" "),t("h2",{attrs:{id:"change-log-level-at-runtime"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#change-log-level-at-runtime"}},[e._v("#")]),e._v(" Change log level at runtime")]),e._v(" "),t("p",[e._v("You can use EMQX Broker's command line tool "),t("code",[e._v("emqx_ctl")]),e._v(" to change the emqx log level at runtime:")]),e._v(" "),t("h3",{attrs:{id:"change-the-global-log-level"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#change-the-global-log-level"}},[e._v("#")]),e._v(" Change the global log level:")]),e._v(" "),t("p",[e._v("For example, set the level of primary log level and all log handlers to debug:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log set-level debug\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"change-the-primary-log-level"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#change-the-primary-log-level"}},[e._v("#")]),e._v(" Change the primary log level:")]),e._v(" "),t("p",[e._v("For example, set the primary log level to debug:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log primary-level debug\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h3",{attrs:{id:"change-the-log-level-of-a-log-handler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#change-the-log-level-of-a-log-handler"}},[e._v("#")]),e._v(" Change the log level of a log handler:")]),e._v(" "),t("p",[e._v("For example, set log handler "),t("code",[e._v("file")]),e._v(" to debug:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log handlers set-level "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("file")]),e._v(" debug\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"log-trace-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#log-trace-2"}},[e._v("#")]),e._v(" Log trace")]),e._v(" "),t("p",[e._v("EMQX Broker supports filtering logs for ClientID or Topic and outputting to files. Before using the log tracing function, the primary log level must be set to debug:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log primary-level debug\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("Enable ClientID log tracing, and output all logs with ClientID 'my_client' to log/my_client.log:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log primary-level debug\ndebug\n\n$ emqx_ctl trace start client my_client log/my_client.log\ntrace clientid my_client successfully\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("Enable the topic log tracing, and output the message publishing log whose topic can match 't/#' to log/topic_t.log:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log primary-level debug\ndebug\n\n$ emqx_ctl trace start topic "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'t/#'")]),e._v(" log/topic_t.log\ntrace topic t/"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# successfully")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("Even if "),t("code",[e._v("log.level")]),e._v(" is set to error in "),t("code",[e._v("emqx.conf")]),e._v(",  debug level information of a client or topic can still be printed out with the message tracing function.  This is very useful in a production environment.")])]),e._v(" "),t("h3",{attrs:{id:"the-principle-of-log-tracing"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-principle-of-log-tracing"}},[e._v("#")]),e._v(" The principle of log tracing")]),e._v(" "),t("p",[e._v("The principle of log tracing is to install a new log handler for emqx and set the filter conditions of the handler. In the "),t("a",{attrs:{href:"#log-level-and-log-handlers"}},[e._v("Log Levels and log handlers")]),e._v(" section, we discussed the details of log handlers.")]),e._v(" "),t("p",[e._v("For example, use the following command to enable client log tracing:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log primary-level debug "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" emqx_ctl trace start client my_client log/my_client.log\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("Then check the tracing that has been started:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl trace list\nTrace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("clientid"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("my_client, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("debug, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("destination")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"log/my_client.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v('In the background, emqx will install a new log handler and specify the filter conditions as follows: Only when the ClientID is "my_client", the log will be output:')]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ emqx_ctl log handlers list\nLogHandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("id"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("trace_clientid_my_client, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("debug, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("destination")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("log/my_client.log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("The id of the newly added log handler here is trace_clientid_my_client, and the handler level is debug. This is why before trace, we must set the primary log level to debug.")]),e._v(" "),t("p",[e._v("If the default primary log level (warning) is used, this log handler will never output the log messages below warning level.")]),e._v(" "),t("p",[e._v("In addition, since we are enabling a new log handler, our log tracing is not constrained by the level of console logs and emqx.log.N file logs. Even if log.level = warning, we can still trace the debug level log of my_client.")])])}),[],!1,null,null,null);a.default=l.exports}}]);