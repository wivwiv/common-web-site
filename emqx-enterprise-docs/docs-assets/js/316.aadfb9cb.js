(window.webpackJsonp=window.webpackJsonp||[]).push([[316],{1666:function(s,a,t){"use strict";t.r(a);var n=t(10),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ldap-认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ldap-认证"}},[s._v("#")]),s._v(" LDAP 认证")]),s._v(" "),t("p",[s._v("LDAP 认证使用外部 LDAP 服务器作为认证数据源，可以存储大量数据，同时方便与外部设备管理系统集成。")]),s._v(" "),t("p",[s._v("插件：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("emqx_auth_ldap\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("emqx_auth_ldap 插件同时包含 ACL 功能，可通过注释禁用。\n目前版本仅支持 OpenLDAP，不支持 Microsoft Active Directory。")])]),s._v(" "),t("h2",{attrs:{id:"ldap-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ldap-配置"}},[s._v("#")]),s._v(" LDAP 配置")]),s._v(" "),t("p",[s._v("要启用 LDAP 认证，需要在 "),t("code",[s._v("etc/plugins/emqx_auth_ldap.conf")]),s._v(" 中配置以下内容：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etc/plugins/emqx_auth_ldap.conf")]),s._v("\n\nauth.ldap.servers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n\nauth.ldap.port "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("389")]),s._v("\n\nauth.ldap.pool "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ldap 的绑定专有名称(DN)")]),s._v("\nauth.ldap.bind_dn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("emqx,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("io\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## \tldap 的绑定密码")]),s._v("\nauth.ldap.bind_password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" public\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ldap 的查询超时时间")]),s._v("\nauth.ldap.timeout "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 30s\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ldap 的设备专有名")]),s._v("\nauth.ldap.device_dn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ou")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("device,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("emqx,dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("io\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ldap 的匹配对象类")]),s._v("\nauth.ldap.match_objectclass "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mqttUser\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ldap 的用户名属性类型")]),s._v("\nauth.ldap.username.attributetype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" uid\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## \tldap 的密码属性类型")]),s._v("\nauth.ldap.password.attributetype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" userPassword\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## TLS 配置项")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.ldap.ssl.certfile = etc/certs/cert.pem")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.ldap.ssl.keyfile = etc/certs/key.pem")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.ldap.ssl.cacertfile = etc/certs/cacert.pem")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.ldap.ssl.verify = verify_peer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.ldap.ssl.fail_if_no_peer_cert = true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("h2",{attrs:{id:"ldap-schema"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ldap-schema"}},[s._v("#")]),s._v(" LDAP Schema")]),s._v(" "),t("p",[s._v("需要在 LDAP schema 目录配置数据模型，默认配置下数据模型如下：")]),s._v(" "),t("p",[t("strong",[s._v("/etc/openldap/schema/emqx.schema")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("attributetype "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.11.2.53.2.2.3.1.2.3.1.3 NAME "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'isEnabled'")]),s._v("\nEQUALITY booleanMatch\nSYNTAX "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.1466.115.121.1.7\nSINGLE-VALUE\nUSAGE userApplications "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nattributetype "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.11.2.53.2.2.3.1.2.3.4.1 NAME "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mqttPublishTopic'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mpt'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEQUALITY caseIgnoreMatch\nSUBSTR caseIgnoreSubstringsMatch\nSYNTAX "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.1466.115.121.1.15\nUSAGE userApplications "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nattributetype "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.11.2.53.2.2.3.1.2.3.4.2 NAME "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mqttSubscriptionTopic'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mst'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEQUALITY caseIgnoreMatch\nSUBSTR caseIgnoreSubstringsMatch\nSYNTAX "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.1466.115.121.1.15\nUSAGE userApplications "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nattributetype "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.11.2.53.2.2.3.1.2.3.4.3 NAME "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mqttPubSubTopic'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mpst'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEQUALITY caseIgnoreMatch\nSUBSTR caseIgnoreSubstringsMatch\nSYNTAX "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.1466.115.121.1.15\nUSAGE userApplications "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nobjectclass "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.11.2.53.2.2.3.1.2.3.4 NAME "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mqttUser'")]),s._v("\nAUXILIARY\nMAY "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" mqttPublishTopic $ mqttSubscriptionTopic $ mqttPubSubTopic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nobjectclass "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.11.2.53.2.2.3.1.2.3.2 NAME "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mqttDevice'")]),s._v("\nSUP "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\nSTRUCTURAL\nMUST "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" uid "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nMAY "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" isEnabled "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nobjectclass "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".6.1.4.1.11.2.53.2.2.3.1.2.3.3 NAME "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mqttSecurity'")]),s._v("\nSUP "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\nAUXILIARY\nMAY "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" userPassword $ userPKCS12 $ pwdAttribute $ pwdLockout "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("编辑 ldap 的配置文件 slapd.conf 引用 Schema：")]),s._v(" "),t("p",[t("strong",[s._v("/etc/openldap/slapd.conf")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("include  /etc/openldap/schema/core.schema\ninclude  /etc/openldap/schema/cosine.schema\ninclude  /etc/openldap/schema/inetorgperson.schema\ninclude  /etc/openldap/schema/ppolicy.schema\ninclude  /etc/openldap/schema/emqx.schema\n\ndatabase bdb\nsuffix "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dc=emqx,dc=io"')]),s._v("\nrootdn "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=root,dc=emqx,dc=io"')]),s._v("\nrootpw "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("SSHA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("eoF7NhNrejVYYyGHqnt+MdKNBh4r1w3W\n\ndirectory       /etc/openldap/data\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);