(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{1234:function(s,t,a){s.exports=a.p+"docs-assets/img/td_create_resource.0a352e52.png"},1235:function(s,t,a){s.exports=a.p+"docs-assets/img/td_creat_action.1e6dd323.png"},1236:function(s,t,a){s.exports=a.p+"docs-assets/img/create_data_towebserver.7f9da3b2.png"},1237:function(s,t,a){s.exports=a.p+"docs-assets/img/td_create_webserver.24703e66.png"},1238:function(s,t,a){s.exports=a.p+"docs-assets/img/td_rule.e2d20519.png"},1239:function(s,t,a){s.exports=a.p+"docs-assets/img/td_queryres.8b4ad9ba.png"},1807:function(s,t,a){"use strict";a.r(t);var n=a(10),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"save-data-to-tdengine"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#save-data-to-tdengine"}},[s._v("#")]),s._v(" Save data to TDengine")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/taosdata/TDengine",target:"_blank",rel:"noopener noreferrer"}},[s._v("TDengine"),n("OutboundLink")],1),s._v(" 是"),n("a",{attrs:{href:"https://www.taosdata.com/cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("涛思数据"),n("OutboundLink")],1),s._v("推出的一款开源的专为物联网、车联网、工业互联网、IT 运维等设计和优化的大数据平台。除核心的快 10 倍以上的时序数据库功能外，还提供缓存、数据订阅、流式计算等功能，最大程度减少研发和运维的复杂度。")]),s._v(" "),n("p",[s._v("EMQX 支持通过 "),n("strong",[s._v("发送到 Web 服务")]),s._v(" 的方式保存数据到 TDengine，也在企业版上提供原生的 TDengine 驱动实现直接保存。")]),s._v(" "),n("p",[s._v("使用 Docker 安装 TDengine 或在 "),n("a",{attrs:{href:"https://marketplace.huaweicloud.com/product/OFFI454488918838128640",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cloud"),n("OutboundLink")],1),s._v(" 上部署：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker run --name TDengine -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6030")]),s._v(":6030 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6035")]),s._v(":6035 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6041")]),s._v(":6041 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6030")]),s._v("-6040:6030-6040/udp tdengine/tdengine \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("进入 Docker 容器：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it TDengine "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\ntaos\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("创建 “test” 数据库:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("create database "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("创建 t_mqtt_msg 表，关于 TDengine 数据结构以及 SQL 命令参见 "),n("a",{attrs:{href:"https://www.taosdata.com/cn/documentation/taos-sql/#%E8%A1%A8%E7%AE%A1%E7%90%86",target:"_blank",rel:"noopener noreferrer"}},[s._v("TAOS SQL"),n("OutboundLink")],1),s._v("：")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USE")]),s._v(" test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_mqtt_msg "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  ts "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  msgid "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("NCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  mqtt_topic "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("NCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  qos "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TINYINT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  payload "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BINARY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  arrived "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("创建规则:")]),s._v(" "),n("p",[s._v("打开 "),n("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[s._v("EMQX Dashboard"),n("OutboundLink")],1),s._v("，选择左侧的 “规则” 选项卡。")]),s._v(" "),n("p",[s._v("填写规则 SQL:")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  now_timestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'millisecond'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" ts\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("img",{attrs:{src:a(392),alt:"image"}})]),s._v(" "),n("p",[s._v("后续动作创建操作可以根据你的 EMQX 版本灵活选择。")]),s._v(" "),n("h2",{attrs:{id:"原生方式-企业版"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#原生方式-企业版"}},[s._v("#")]),s._v(" 原生方式（企业版）")]),s._v(" "),n("p",[s._v("关联动作:")]),s._v(" "),n("p",[s._v("在 “响应动作” 界面选择 “添加”，然后在 “动作” 下拉框里选择 “保存数据到 TDengine”。")]),s._v(" "),n("blockquote",[n("p",[s._v("仅限企业版 4.1.1 及以后版本。")])]),s._v(" "),n("p",[s._v("填写动作参数:")]),s._v(" "),n("p",[s._v("“保存数据到 TDengine” 动作需要两个参数：")]),s._v(" "),n("ol",[n("li",[s._v("SQL 模板。这个例子里我们向 TDengine 插入一条数据，注意我们应当在 SQL 中指定数据库名，字符类型也要用单引号括起来，SQL 模板为：")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t_mqtt_msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msgid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mqtt_topic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" qos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" arrived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("${ts}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${id}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${topic}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${qos}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${payload}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),s._v("}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("关联资源的 ID。现在资源下拉框为空，可以点击右上角的 “新建资源” 来创建一个 TDengine资源:")])]),s._v(" "),n("p",[s._v("填写资源配置:")]),s._v(" "),n("p",[s._v("用户名填写 “root”，密码填写缺省密码 “taosdata”，"),n("strong",[s._v("TDengine 不在资源中配置数据库名，请在 SQL 中自行配置。")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1234),alt:"image"}})]),s._v(" "),n("p",[s._v("点击 “新建” 按钮。")]),s._v(" "),n("p",[s._v("返回响应动作界面，点击 “确认”。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1235),alt:"image"}})]),s._v(" "),n("p",[s._v("返回规则创建界面，点击 “创建”。")]),s._v(" "),n("h2",{attrs:{id:"通过发送数据到-web-服务写入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过发送数据到-web-服务写入"}},[s._v("#")]),s._v(" 通过发送数据到 Web 服务写入")]),s._v(" "),n("p",[s._v("为支持各种不同类型平台的开发，TDengine 提供符合 REST 设计标准的 API。通过 "),n("a",{attrs:{href:"https://www.taosdata.com/cn/documentation/connector/#RESTful-Connector",target:"_blank",rel:"noopener noreferrer"}},[s._v("RESTful Connector"),n("OutboundLink")],1),s._v(" 提供了最简单的连接方式，即使用 HTTP 请求携带认证信息与要执行的 SQL 操作 TDengine。")]),s._v(" "),n("p",[s._v("EMQX 规则引擎中有功能强大的"),n("strong",[s._v("发送数据到 Web 服务功能")]),s._v("，可以实现无缝实现上述操作。")]),s._v(" "),n("p",[s._v("关联动作:")]),s._v(" "),n("p",[s._v("在 “响应动作” 界面选择 “添加”，然后在 “动作” 下拉框里选择 “保存数据到 Web 服务“。")]),s._v(" "),n("p",[s._v("EMQX 规则引擎中有功能强大的****发送数据到 Web 服务功能****，可以实现无缝实现上述操作。")]),s._v(" "),n("p",[s._v("填写动作参数:")]),s._v(" "),n("p",[s._v("“保存数据到 Web 服务” 动作需要 5 个参数：")]),s._v(" "),n("ol",[n("li",[s._v("使用资源：关联 Web Server 资源，可点击创建按钮新建资源")]),s._v(" "),n("li",[s._v("Method：HTTP 请求方式，使用 "),n("code",[s._v("POST")])]),s._v(" "),n("li",[s._v("Path：写入数据路径 "),n("code",[s._v("/rest/sql")])]),s._v(" "),n("li",[s._v("Headers：使用 "),n("code",[s._v("Basic")]),s._v(' 认证，默认用户名密码 "root:taosdata" '),n("code",[s._v("base64")]),s._v(" 编码 "),n("code",[s._v("cm9vdDp0YW9zZGF0YQ==")])]),s._v(" "),n("li",[s._v("Body：请求体\n这个例子里我们向 TDengine 插入一条数据，应当在请求体内拼接携带 INSERT SQL 。注意我们应当在 SQL 中指定数据库名，字符类型也要用单引号括起来，消息内容模板为：")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 注意：topic 处添加了作为标识，因为此示例中我们会有两个资源写入 TDengine，标识区分了原生方式与 Web Server 写入的数据")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t_mqtt_msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msgid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" mqtt_topic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" qos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" arrived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("${ts}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${id}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http server ${topic}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${qos}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${payload}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),s._v("}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:a(1236),alt:"image"}})]),s._v(" "),n("p",[s._v("创建关联的 Web Server 资源：\n"),n("br"),s._v("\n填写资源配置：\n"),n("br"),s._v("\n请求 URL 填写 http://127.0.0.1:6041，其他字段按照服务器设定填写即可。配置了加密传输请填写证书信息。示例中仅使用默认的参数配置。\n"),n("br"),s._v("\n返回规则创建界面，点击 “创建”。\n"),n("img",{attrs:{src:a(1237),alt:"image"}})]),s._v(" "),n("h2",{attrs:{id:"测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),n("p",[s._v("在规则列表里，点击规则 ID 连接，可以预览刚才创建的规则:")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1238),alt:"image"}})]),s._v(" "),n("p",[s._v("规则已经创建完成，现在发一条数据:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("Topic: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t/a"')]),s._v("\nQoS: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nPayload: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("然后检查 TDengine 表，新的 record 是否添加成功:")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" t_mqtt_msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:a(1239),alt:"image"}})])])}),[],!1,null,null,null);t.default=e.exports},392:function(s,t,a){s.exports=a.p+"docs-assets/img/rule_sql.91dfbea9.png"}}]);