(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{1481:function(e,s,t){"use strict";t.r(s);var a=t(10),n=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[e._v("#")]),e._v(" Redis")]),e._v(" "),t("p",[e._v("Redis authentication uses an external Redis database as the authentication data source, which can store a large amount of data and facilitate integration with external device management systems.")]),e._v(" "),t("p",[e._v("Plugin:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("emqx_auth_redis\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("The emqx_auth_redis lso includes ACL feature, which can be disabled via comments")])]),e._v(" "),t("p",[e._v("To enable Redis authentication, you need to configure the following in "),t("code",[e._v("etc/plugins/emqx_auth_redis.conf")]),e._v(" ：")]),e._v(" "),t("h2",{attrs:{id:"redis-connection-information"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-connection-information"}},[e._v("#")]),e._v(" Redis connection information")]),e._v(" "),t("p",[e._v("For Redis basic connection information, it needs to ensure that all nodes in the cluster can access.")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# etc/plugins/emqx_auth_redis.conf")]),e._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Server address")]),e._v("\nauth.redis.server "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:6379\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Connection pool size")]),e._v("\nauth.redis.pool "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("8")]),e._v("\n\nauth.redis.database "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n\nauth.redis.password "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" \n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br")])]),t("h2",{attrs:{id:"default-table-structure"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#default-table-structure"}},[e._v("#")]),e._v(" Default table structure")]),e._v(" "),t("p",[e._v("A hash table is used to store authentication data by default for Redis authentication, and "),t("code",[e._v("mqtt_user:")]),e._v(" is used as the Redis key prefix. The data structure is as follows:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" hgetall mqtt_user:emqx\n  password public\n  salt wivwiv\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("The sample data in the default configuration is as follows:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("HMSET mqtt_user:emqx password public salt wivwiv\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("After Redis  authentication is enabled, you can connect with username: emqx, password: public.")]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("This is the data structure used by default configuration. After being familiar with the use of the plugin, you can use any data structure that meets the conditions for authentication")])]),e._v(" "),t("h2",{attrs:{id:"salting-rules-and-hash-methods"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#salting-rules-and-hash-methods"}},[e._v("#")]),e._v(" Salting rules and hash methods")]),e._v(" "),t("p",[e._v("Redis authentication supports the configuration of "),t("RouterLink",{attrs:{to:"/en/enterprise/latest/advanced/auth.html#password-salting-rules-and-hash-methods"}},[e._v("salting rules and hash methods")]),e._v(", and plaintext passwords are stored without processing by default:")],1),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# etc/plugins/emqx_auth_redis.conf")]),e._v("\n\nauth.redis.password_hash "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" plain\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("h2",{attrs:{id:"auth-query-cmd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#auth-query-cmd"}},[e._v("#")]),e._v(" auth query cmd")]),e._v(" "),t("p",[e._v("During authentication, EMQX Broker will use the current client information to populate and execute the user-configured authentication query command to query the client's authentication data in the Redis.")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# etc/plugins/emqx_auth_redis.conf")]),e._v("\n\nauth.redis.auth_cmd "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" HMGET mqtt_user:%u password\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("You can use the following placeholders in the command, and EMQX Broker will be automatically populated with client information when executed:")]),e._v(" "),t("ul",[t("li",[e._v("%u：Username")]),e._v(" "),t("li",[e._v("%c：Client ID")]),e._v(" "),t("li",[e._v("%C：TLS certificate common name (the domain name or subdomain name of the certificate), valid only for TLS connections")]),e._v(" "),t("li",[e._v("%d：TLS certificate subject, valid only for TLS connections")])]),e._v(" "),t("p",[e._v("You can adjust the authentication query command according to your business needs and use any  "),t("a",{attrs:{href:"http://redisdoc.com/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis supported command"),t("OutboundLink")],1),e._v(". However, in any case, the authentication query command must meet the following conditions:")]),e._v(" "),t("ol",[t("li",[e._v("The first data in the query result must be password. EMQX Broker will use this field to compare with the client password.")]),e._v(" "),t("li",[e._v("If the salting configuration is enabled, the second data in the query result must be the salt field. EMQX Broker will use this field as the salt value.")])])])}),[],!1,null,null,null);s.default=n.exports}}]);