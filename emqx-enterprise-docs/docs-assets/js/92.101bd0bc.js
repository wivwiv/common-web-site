(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{1601:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"save-data-to-clickhouse"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#save-data-to-clickhouse"}},[s._v("#")]),s._v(" Save data to ClickHouse")]),s._v(" "),e("p",[s._v("Steup the ClickHouse database, and set username/password to default/public. Taking CentOS as example:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## install dependencies")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y epel-release\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## download and run the installation script provided by packagecloud.io")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -s https://packagecloud.io/install/repositories/altinity/clickhouse/script.rpm.sh "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## install ClickHouse server and client")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y clickhouse-server clickhouse-client\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## start the ClickHouse server")]),s._v("\nclickhouse-server\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## start the ClickHouse client")]),s._v("\nclickhouse-client\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("Create the "),e("code",[s._v("test")]),s._v(" database:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("create database "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("create "),e("code",[s._v("t_mqtt_msg")]),s._v(" table:")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" t_mqtt_msg "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msgid Nullable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" topic Nullable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" clientid Nullable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" payload Nullable"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Log"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("img",{attrs:{src:a(663),alt:""}})]),s._v(" "),e("p",[e("strong",[s._v("Create the rule:")])]),s._v(" "),e("p",[s._v("Go to the "),e("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[s._v("EMQX Dashboard"),e("OutboundLink")],1),s._v(", and type in the follwing SQL:")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:a(664),alt:"image"}})]),s._v(" "),e("p",[e("strong",[s._v("Select an action:")])]),s._v(" "),e("p",[s._v('Add an action and select "Data to ClickHouse" from the dropdown list.')]),s._v(" "),e("p",[e("img",{attrs:{src:a(665),alt:"image"}})]),s._v(" "),e("p",[s._v("Provide the arguments of the action:")]),s._v(" "),e("p",[s._v("1). The resource id. We create a new clickhouse resource now:")]),s._v(" "),e("p",[s._v('Click "create" right to the resource Id text box, and then select "clickhouse" and fill in the following paramenters:')]),s._v(" "),e("p",[e("img",{attrs:{src:a(666),alt:"image"}})]),s._v(" "),e("p",[s._v('Click the "Confirm" button.')]),s._v(" "),e("p",[s._v("2). The SQL template. In this example we insert an message to clickhouse:")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t_mqtt_msg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msgid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" clientid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" topic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${id}'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${clientid}'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${topic}'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${payload}'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:a(667),alt:"image"}})]),s._v(" "),e("p",[s._v("Keep all other arguments unchanged and confirm the action creation.")]),s._v(" "),e("p",[s._v('Then click "Create" to confirm the rule creation.')]),s._v(" "),e("p",[s._v("Now the rule has been created, we send an testing message to the broker:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("Topic: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t/a"')]),s._v("\nQoS: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nPayload: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("And then we can verify if the message is inserted to the clickhouse table:")]),s._v(" "),e("p",[e("img",{attrs:{src:a(668),alt:"image"}})])])}),[],!1,null,null,null);t.default=n.exports},663:function(s,t,a){s.exports=a.p+"docs-assets/img/clickhouse_0.ce25e9be.png"},664:function(s,t,a){s.exports=a.p+"docs-assets/img/clickhouse_1.08bdba5c.png"},665:function(s,t,a){s.exports=a.p+"docs-assets/img/clickhouse_2.9b3db9d7.png"},666:function(s,t,a){s.exports=a.p+"docs-assets/img/clickhouse_4.eaf490b3.png"},667:function(s,t,a){s.exports=a.p+"docs-assets/img/clickhouse_5.c93370e4.png"},668:function(s,t,a){s.exports=a.p+"docs-assets/img/clickhouse_8.86453ad0.png"}}]);