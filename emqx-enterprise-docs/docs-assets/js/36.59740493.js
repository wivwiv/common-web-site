(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{1611:function(s,e,a){"use strict";a.r(e);var t=a(10),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"save-data-to-redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#save-data-to-redis"}},[s._v("#")]),s._v(" Save data to Redis")]),s._v(" "),t("p",[s._v("Setup a Redis database, taking Mac OSX for instance:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://download.redis.io/releases/redis-4.0.14.tar.gz\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xzf redis-4.0.14.tar.gz\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis-4.0.14\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start redis")]),s._v("\n$ redis-server\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("Create a rule:")]),s._v(" "),t("p",[s._v("Go to "),t("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[s._v("EMQX Dashboard"),t("OutboundLink")],1),s._v(', select the "rule" tab on the menu to the left.')]),s._v(" "),t("p",[s._v('Select "message.publish", then type in the following SQL:')]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message.publish"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("img",{attrs:{src:a(393),alt:"image"}})]),s._v(" "),t("p",[s._v("Bind an action:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('Click on the "+ Add" button under "Action Handler", and then select\n"Data to MySQL" in the pop-up dialog window.\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:a(734),alt:"image"}})]),s._v(" "),t("p",[s._v("Fill in the parameters required by the action:")]),s._v(" "),t("p",[s._v('Two parameters is required by action "Data to Redis":')]),s._v(" "),t("p",[s._v("1). Redis CMD. The redis command you'd like to run when the action is\ntriggered. In this example we'll insert a message into redis, so type in the following command:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("HMSET mqtt:msg:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${id}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${id}")]),s._v(" from "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${client_id}")]),s._v(" qos "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${qos}")]),s._v(" topic "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${topic}")]),s._v(" payload "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${payload}")]),s._v(" retain "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${retain}")]),s._v(" ts "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${timestamp}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:a(735),alt:"image"}})]),s._v(" "),t("p",[s._v('2). Bind a resource to the action. Since the dropdown list "Resource"\nis empty for now, we create a new resource by clicking on the "New\nResource" to the top right, and then select "Redis Single Mode":')]),s._v(" "),t("p",[t("img",{attrs:{src:a(736),alt:"image"}})]),s._v(" "),t("p",[s._v("Configure the resource:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('Fill in the "Redis Server", and keep all other configs as default,\nand click on the "Testing Connection" button to make sure the\nconnection can be created successfully, and then click on the\n"Create" button.\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("img",{attrs:{src:a(737),alt:"image"}})]),s._v(" "),t("p",[s._v('Back to the "Actions" dialog, and then click on the "Confirm" button.')]),s._v(" "),t("p",[t("img",{attrs:{src:a(738),alt:"image"}})]),s._v(" "),t("p",[s._v('Back to the creating rule page, then click on "Create" button. The\nrule we created will be show in the rule list:')]),s._v(" "),t("p",[t("img",{attrs:{src:a(739),alt:"image"}})]),s._v(" "),t("p",[s._v("We have finished, testing the rule by sending an MQTT message to\nemqx:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Topic: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t/1"')]),s._v("\n\nQoS: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nRetained: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\nPayload: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("Then inspect the Redis table, verify a new record has been inserted:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("$ redis-cli\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" KEYS mqtt:msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("*\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" hgetall "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("img",{attrs:{src:a(740),alt:"image"}})]),s._v(" "),t("p",[s._v('And from the rule list, verify that the "Matched" column has increased\nto 1:')]),s._v(" "),t("p",[t("img",{attrs:{src:a(741),alt:"image"}})])])}),[],!1,null,null,null);e.default=n.exports},393:function(s,e,a){s.exports=a.p+"docs-assets/img/mysql_sql_1.515176ea.png"},734:function(s,e,a){s.exports=a.p+"docs-assets/img/redis_action_0.585ce1c1.png"},735:function(s,e,a){s.exports=a.p+"docs-assets/img/redis_action_1.0087c16e.png"},736:function(s,e,a){s.exports=a.p+"docs-assets/img/redis_action_2.d304d96b.png"},737:function(s,e,a){s.exports=a.p+"docs-assets/img/redis_resource_0.2e34b867.png"},738:function(s,e,a){s.exports=a.p+"docs-assets/img/redis_action_3.800fd8dd.png"},739:function(s,e,a){s.exports=a.p+"docs-assets/img/redis_rule_overview_0.d358915a.png"},740:function(s,e,a){s.exports=a.p+"docs-assets/img/redis_result.08cc0ba7.png"},741:function(s,e,a){s.exports=a.p+"docs-assets/img/redis_rule_overview_1.f1865f55.png"}}]);