(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{1053:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_jt8081.116f99fb.png"},1054:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_jt8082.8480eb53.png"},1055:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_jt8083.40529b2c.png"},1056:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_jt8084.fe46c9d4.png"},1057:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_jt8085.45ae6ad6.png"},1058:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_jt8086.14cb1cec.png"},1769:function(s,t,a){"use strict";a.r(t);var n=a(10),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"jt-t808-协议网关"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jt-t808-协议网关"}},[s._v("#")]),s._v(" JT/T808 协议网关")]),s._v(" "),n("h2",{attrs:{id:"协议介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#协议介绍"}},[s._v("#")]),s._v(" 协议介绍")]),s._v(" "),n("p",[n("strong",[s._v("emqx-jt808")]),s._v(" 做为 emqx 的接入网关，按照其功能逻辑和整个系统的关系，将整个消息交换的过程可以分成三个部分：终端侧，平台侧和其它侧：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("|<-- Terminal --\x3e|<---------- Broker Side ----------\x3e|<---  Others  ---\x3e|\n|<-    Side    ->|                                   |<--    Side    --\x3e|\n\n+---+                                                  PUB  +-----------+\n| D |  INCOMING  +------------+    PUB     +---------+   --\x3e| subscriber|\n| E |-----------\x3e|            |-----------\x3e|         |--/   +-----------+\n| V |            | emqx-jt808 |            |  EMQX  |\n| I |<-----------|            |<-----------|         |<--   +-----------+\n| C |  OUTGOING  +------------+    PUB     +---------+   \\--| publisher |\n| E |                                                  PUB  +-----------+\n+---+\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ol",[n("li",[s._v("终端侧：通过 JT/T 808 协议进行交换数据，实现不同类型的数据的上报，或者发送下行的消息到终端。")]),s._v(" "),n("li",[s._v("平台侧：emqx-jt808 将报文解码后执行 注册/鉴权、或将数据报文 PUBLISH 到特定的主题上；代理订阅下行主题，将下行的 PUBLISH 消息转化为 JT/T 808 协议的报文结构，下发到终端。")]),s._v(" "),n("li",[s._v("其它侧，可以对 2 中出现的上行的 PUBLISH 消息的主题进行订阅，以接收上行消息。或对发布消息到具体的下行的主题，以发送数据到终端侧。")])]),s._v(" "),n("h2",{attrs:{id:"创建模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建模块"}},[s._v("#")]),s._v(" 创建模块")]),s._v(" "),n("p",[s._v("打开 "),n("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[s._v("EMQX Dashboard"),n("OutboundLink")],1),s._v("，点击左侧的 “模块” 选项卡，选择添加：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(390),alt:"image-20200927213049265"}})]),s._v(" "),n("p",[s._v("选择 JT/T808 协议接入网关:")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1053),alt:"image-20200927213049265"}})]),s._v(" "),n("p",[s._v("配置相关基础参数:")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1054),alt:"image-20200927213049265"}})]),s._v(" "),n("p",[s._v("添加监听端口:")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1055),alt:"image-20200927213049265"}})]),s._v(" "),n("p",[s._v("配置监听参数:")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1056),alt:"image-20200927213049265"}})]),s._v(" "),n("p",[s._v("点击确认到配置参数页面:")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1057),alt:"image-20200927213049265"}})]),s._v(" "),n("p",[s._v("点击添加后，模块添加完成:\n"),n("img",{attrs:{src:a(1058),alt:"image-20200927213049265"}})]),s._v(" "),n("p",[n("strong",[s._v("emqx-jt808 实现规定：")])]),s._v(" "),n("ul",[n("li",[s._v("系统内以手机号作为一个连接的唯一标识，即 ClientId")])]),s._v(" "),n("h3",{attrs:{id:"配置参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置参数"}},[s._v("#")]),s._v(" 配置参数")]),s._v(" "),n("p",[s._v("emqx-jt808 的实现支持匿名的方式接入认证：")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("配置项")]),s._v(" "),n("th",[s._v("说明")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("允许匿名登录")]),s._v(" "),n("td",[s._v("是否允许匿名用户登录")])]),s._v(" "),n("tr",[n("td",[s._v("注册服务地址")]),s._v(" "),n("td",[s._v("JT/T808 终端注册的 HTTP 接口地址")])]),s._v(" "),n("tr",[n("td",[s._v("认证服务地址")]),s._v(" "),n("td",[s._v("JT/T808 终端接入鉴权的 HTTP 接口地址")])]),s._v(" "),n("tr",[n("td",[s._v("下行消息主题格式")]),s._v(" "),n("td",[s._v("上行主题。上行消息到 EMQX 系统中的消息主题%c: 接入客户端的 ClientId,%p: 接入客户端的 Phone")])]),s._v(" "),n("tr",[n("td",[s._v("上行消息主题格式")]),s._v(" "),n("td",[s._v("下行主题。上行消息到 EMQX 系统中的消息主题%c: 接入客户端的 ClientId,%p: 接入客户端的 Phone")])]),s._v(" "),n("tr",[n("td",[s._v("允许最大报文长度")]),s._v(" "),n("td",[s._v("最大处理的单个JT/T808协议报文大小")])])])]),s._v(" "),n("h3",{attrs:{id:"注册及鉴权"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注册及鉴权"}},[s._v("#")]),s._v(" 注册及鉴权")]),s._v(" "),n("p",[s._v("注册请求详细格式如下：")]),s._v(" "),n("p",[n("strong",[s._v("注册请求：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('    URL: http://127.0.0.1:8991/jt808/registry\n    Method: POST\n    Body:\n       { "province": 58,\n         "city": 59,\n         "manufacturer": "Infinity",\n         "model": "Q2",\n         "license_number": "ZA334455",\n         "dev_id": "xx11344",\n         "color": 3,\n         "phone", "00123456789"\n       }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("strong",[s._v("注册应答：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('{\n  "code": 0,\n  "authcode": "132456789"\n}\n\n或:\n\n{\n  "code": 1\n}\n\n其中返回码可以为：\n\n0: 成功\n1: 车辆已被注册\n2: 数据库中无该车辆\n3: 终端已被注册\n4: 数据库中无该终端\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[n("strong",[s._v("鉴权请求：")])]),s._v(" "),n("div",{staticClass:"language-properties line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    URL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("http://127.0.0.1:8991/jt808/auth")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    Method")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("POST")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("    Body")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("       {")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v('"code": "authcode",')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v('         "phone",')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v('"00123456789"')]),s._v("\n       }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("鉴权应答：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("HTTP 状态码 200: 鉴权成功\n其他: 鉴权失败\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("注：鉴权请求只会在系统未保存鉴权码时调用（即终端直接发送鉴权报文进行登录系统）")]),s._v(" "),n("h3",{attrs:{id:"数据上下行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据上下行"}},[s._v("#")]),s._v(" 数据上下行")]),s._v(" "),n("p",[s._v("emqx-jt808 中通过配置上下行主题来收发终端消息：")]),s._v(" "),n("h4",{attrs:{id:"上行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#上行"}},[s._v("#")]),s._v(" 上行")]),s._v(" "),n("p",[s._v("例如："),n("strong",[s._v("制造商Id")]),s._v(" 为 "),n("code",[s._v("abcde")]),s._v(" 和 "),n("strong",[s._v("终端Id")]),s._v(" 为 "),n("code",[s._v("1234567")]),s._v(" 的设备。")]),s._v(" "),n("p",[s._v("首先先使用 MQTT 客户端订阅主题 "),n("code",[s._v("jt808/abcde1234567/up")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-properties line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-properties"}},[n("code",[n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("$")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("mosquitto_sub -t jt808/abcde1234567/up")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("例如终端在上报 "),n("code",[s._v("数据上行透传(0x0900)")]),s._v(" 类型的消息后，订阅端会收到：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"body"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MTIzNDU2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("240")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"header"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"encrypt"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"len"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg_id"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2304")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg_sn"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"phone"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"011111111111"')]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("注：透明传输类，data 域的内容会 base64 编码一次在上报出来")]),s._v(" "),n("h4",{attrs:{id:"数据下行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据下行"}},[s._v("#")]),s._v(" 数据下行")]),s._v(" "),n("p",[s._v("同样，以上行的ID为例；在终端鉴权成功后，使用 MQTT 客户端向该终端下发一个 '数据下行透传(0x8900)' 类型的消息：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ mosquitto_pub -t jt808/abcde1234567/dn -m \'{"body":{"data":"MTIzNDU2","type":240},"header":{"msg_id":35072}}\'\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("注：下行 JSON 中，header 中的内容只需要带 msg_id 即可；body 中的内容根据不同的 msg_id 有不同的结构")])])}),[],!1,null,null,null);t.default=e.exports},390:function(s,t,a){s.exports=a.p+"docs-assets/img/modules.89e07c9c.png"}}]);