(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{1614:function(t,e,s){"use strict";s.r(e);var a=s(10),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"save-data-to-tdengine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#save-data-to-tdengine"}},[t._v("#")]),t._v(" Save data to TDengine")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/taosdata/TDengine",target:"_blank",rel:"noopener noreferrer"}},[t._v("TDengine"),a("OutboundLink")],1),t._v(" "),a("br"),t._v("\nTaosData(https://www.taosdata.com)\nEnables efficient, real-time data ingestion, processing and monitoring of TB and even PB scale data per day, generated by billions of sensors and data collectors. TDengine can be widely applied to IoT, Industrial Internet, Connected Vehicles, DevOps, Energy , Finance and many other use-cases.")]),t._v(" "),a("p",[t._v("EMQX supports saving data to TDengine via "),a("strong",[t._v("Send to Web Server")]),t._v(", and also provides native TDengine drivers on EMQX Enterprise for direct saving.")]),t._v(" "),a("p",[t._v("Install TDengine by docker or "),a("a",{attrs:{href:"https://marketplace.huaweicloud.com/product/OFFI454488918838128640",target:"_blank",rel:"noopener noreferrer"}},[t._v("Huawei Cloud"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("docker run --name TDengine -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6030")]),t._v(":6030 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6035")]),t._v(":6035 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6041")]),t._v(":6041 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6030")]),t._v("-6040:6030-6040/udp tdengine/tdengine \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("Execute cmd in docker:")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it TDengine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\ntaos\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("Create database "),a("code",[t._v("test")])]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("create database "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("Create table "),a("code",[t._v("t_mqtt_msg")]),t._v(". More "),a("a",{attrs:{href:"https://tdengine.com/docs/en/v2.0/taos-sql",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs"),a("OutboundLink")],1),t._v(":")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USE")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" t_mqtt_msg "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  ts "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("timestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  msgid "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("NCHAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  mqtt_topic "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("NCHAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  qos "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TINYINT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  payload "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BINARY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  arrived "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("timestamp")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("Create Rule:")]),t._v(" "),a("p",[t._v("Open "),a("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("EMQX Dashboard"),a("OutboundLink")],1),t._v(". Click "),a("code",[t._v("Rule")]),t._v(".")]),t._v(" "),a("p",[t._v("Write SQL:")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  now_timestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'millisecond'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ts\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#"')]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[a("img",{attrs:{src:s(756),alt:"image"}})]),t._v(" "),a("p",[t._v("The subsequent action creation operation can be selected flexibly depending on your EMQX version.")]),t._v(" "),a("h2",{attrs:{id:"native-sdk-emqx-enterprise"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#native-sdk-emqx-enterprise"}},[t._v("#")]),t._v(" Native SDK (EMQX Enterprise)")]),t._v(" "),a("p",[t._v("Add Action:")]),t._v(" "),a("p",[t._v("Find "),a("code",[t._v("Action")]),t._v(", click "),a("code",[t._v("Add Action")]),t._v(".")]),t._v(" "),a("p",[t._v("Click "),a("code",[t._v("Data persist")]),t._v(", Choice "),a("code",[t._v("Data to TDengine")]),t._v(".")]),t._v(" "),a("blockquote",[a("p",[t._v("Requires EMQX Enterprise 4.1.1 and later only.")])]),t._v(" "),a("p",[t._v("Action parameters:")]),t._v(" "),a("ol",[a("li",[t._v("SQL template. In this example we insert a data to TDengine, note that we should specify the database name in the SQL and the character type should be enclosed in single quotes, the SQL template:")])]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("t_mqtt_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msgid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mqtt_topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arrived"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("${ts}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'${id}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'${topic}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ${qos}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'${payload}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ${"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("timestamp")]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Now that the resource drop-down box is empty, you can create a TDengine resource by clicking on "),a("code",[t._v("Create")]),t._v(" in the upper right corner:")])]),t._v(" "),a("p",[t._v("Create new TDengine Resource:\n"),a("br"),t._v("\nTDEngine Username: root\n"),a("br"),t._v("\nTDEngine password: taosdata\n"),a("br")]),t._v(" "),a("p",[a("img",{attrs:{src:s(757),alt:"image"}})]),t._v(" "),a("p",[t._v("Click "),a("code",[t._v("Confirm")]),t._v(".")]),t._v(" "),a("p",[t._v('Return to the action screen and click "Confirm".')]),t._v(" "),a("p",[a("img",{attrs:{src:s(758),alt:"image"}})]),t._v(" "),a("p",[t._v('Return to the rule screen and click "Create".')]),t._v(" "),a("h2",{attrs:{id:"write-by-web-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#write-by-web-server"}},[t._v("#")]),t._v(" Write by Web Server")]),t._v(" "),a("p",[t._v("To support development on different types of platforms, TDengine provides APIs that conform to REST design standards.")]),t._v(" "),a("p",[t._v("The "),a("a",{attrs:{href:"https://www.taosdata.com/cn/documentation/connector/#RESTful-Connector",target:"_blank",rel:"noopener noreferrer"}},[t._v("RESTful Connector"),a("OutboundLink")],1),t._v(" provides the simplest way to connect, i.e. using HTTP requests carrying authentication information with the SQL operation to be performed TDengine.")]),t._v(" "),a("p",[t._v("Add Action:")]),t._v(" "),a("p",[t._v("Find "),a("code",[t._v("Action")]),t._v(", click "),a("code",[t._v("Add Action")]),t._v(".")]),t._v(" "),a("p",[t._v("Click "),a("code",[t._v("Data persist")]),t._v(", Choice "),a("code",[t._v("Data to Web Server")]),t._v(".")]),t._v(" "),a("p",[a("code",[t._v("Data to Web Server")]),t._v(" parameters:")]),t._v(" "),a("ol",[a("li",[t._v("Using of resources: Associated Web Server resources, you can click the Create button to create new resources.")]),t._v(" "),a("li",[t._v("Method:"),a("code",[t._v("POST")])]),t._v(" "),a("li",[t._v("Path: "),a("code",[t._v("/rest/sql")])]),t._v(" "),a("li",[t._v("Headers: "),a("code",[t._v("Authorization Basic")]),t._v(', "root:taosdata" base64 encode is '),a("code",[t._v("cm9vdDp0YW9zZGF0YQ==")])]),t._v(" "),a("li",[t._v("Body: Request Body. In this example we are inserting a piece of data into TDengine, which should carry the INSERT SQL within the request body, noting that we should specify the database name in the SQL and the character type should be enclosed in single quotes, with the message content template as follows")])]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- Note: the topic is added as an identifier because in this example we will have two resources written to TDengine, and the identifier distinguishes between the data written natively and by the Web Server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("t_mqtt_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msgid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mqtt_topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" qos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arrived"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("${ts}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'${id}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http server ${topic}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ${qos}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'${payload}'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ${"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("timestamp")]),t._v("}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:s(759),alt:"image"}})]),t._v(" "),a("p",[t._v("Create Web Server resource:")]),t._v(" "),a("br"),t._v("\nWeb Server config:\n"),a("br"),t._v("\nRequest URL is http://127.0.0.1:6041.\n"),a("br"),t._v("\nPlease fill in the other fields according to the server settings. If encrypted transmission is configured, please fill in the certificate information. Only the default parameters are used in the example.\n"),a("br"),t._v('\nReturn to the rule screen and click "Create".\n'),a("p",[a("img",{attrs:{src:s(760),alt:"image"}})]),t._v(" "),a("h2",{attrs:{id:"test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test"}},[t._v("#")]),t._v(" Test")]),t._v(" "),a("p",[t._v("In the rule list, click on the Rule ID link to preview the rule you just created.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(761),alt:"image"}})]),t._v(" "),a("p",[t._v("The rule has been created, now send a data:")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("Topic: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"t/a"')]),t._v("\nQoS: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nPayload: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msg"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("Query and check:")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" t_mqtt_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:s(762),alt:"image"}})])])}),[],!1,null,null,null);e.default=n.exports},756:function(t,e,s){t.exports=s.p+"docs-assets/img/td_new_reul.0d63e0e6.png"},757:function(t,e,s){t.exports=s.p+"docs-assets/img/td_create_resource.27e65a4c.png"},758:function(t,e,s){t.exports=s.p+"docs-assets/img/td_creat_action.e9f761f2.png"},759:function(t,e,s){t.exports=s.p+"docs-assets/img/create_data_towebserver.0cc71bc6.png"},760:function(t,e,s){t.exports=s.p+"docs-assets/img/td_create_webserver.3424aab2.png"},761:function(t,e,s){t.exports=s.p+"docs-assets/img/td_rule.9fdb234b.png"},762:function(t,e,s){t.exports=s.p+"docs-assets/img/td_queryres.8b4ad9ba.png"}}]);