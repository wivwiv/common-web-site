(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{1023:function(e,a,t){e.exports=t.p+"docs-assets/img/coap_add.3bc5f084.jpg"},1024:function(e,a,t){e.exports=t.p+"docs-assets/img/coap_conf1.74b3735a.jpg"},1025:function(e,a,t){e.exports=t.p+"docs-assets/img/coap_conf2.dffe29b9.jpg"},1026:function(e,a,t){e.exports=t.p+"docs-assets/img/coap_conf3.255e296e.jpg"},1027:function(e,a,t){e.exports=t.p+"docs-assets/img/coap_conf4.729e8b02.jpg"},1761:function(e,a,t){"use strict";t.r(a);var s=t(10),i=Object(s.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"coap-协议网关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coap-协议网关"}},[e._v("#")]),e._v(" CoAP 协议网关")]),e._v(" "),s("p",[e._v("CoAP 协议网关为 EMQX 提供了 CoAP 协议的接入能力。它允许符合某种定义的 CoAP 消息格式向 EMQX 执行发布，订阅，和接收消息等操作。")]),e._v(" "),s("h2",{attrs:{id:"创建模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建模块"}},[e._v("#")]),e._v(" 创建模块")]),e._v(" "),s("p",[e._v("打开 "),s("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("EMQX Dashboard"),s("OutboundLink")],1),e._v("，点击左侧的 “模块” 选项卡，选择添加：")]),e._v(" "),s("p",[s("img",{attrs:{src:t(390),alt:"image-20200928161310952"}})]),e._v(" "),s("p",[e._v("点击 “选择”，然后选择 “CoAP 接入网关”：")]),e._v(" "),s("p",[s("img",{attrs:{src:t(1023),alt:"Create CoAP Protocol Gateway"}})]),e._v(" "),s("p",[e._v("配置相关基础参数：")]),e._v(" "),s("p",[s("img",{attrs:{src:t(1024),alt:"Configure CoAP Protocol Gateway"}})]),e._v(" "),s("p",[e._v("添加监听端口：")]),e._v(" "),s("p",[s("img",{attrs:{src:t(1025),alt:"Configure CoAP Protocol Gateway"}})]),e._v(" "),s("p",[e._v("配置监听参数：")]),e._v(" "),s("p",[s("img",{attrs:{src:t(1026),alt:"Configure CoAP Protocol Gateway"}})]),e._v(" "),s("p",[e._v("点击 “确定” 完成监听器的配置，然后点击 “添加” 完成模块的创建：")]),e._v(" "),s("p",[s("img",{attrs:{src:t(1027),alt:"Complete CoAP Protocol Gateway"}})]),e._v(" "),s("h2",{attrs:{id:"使用示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用示例"}},[e._v("#")]),e._v(" 使用示例")]),e._v(" "),s("h3",{attrs:{id:"客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端"}},[e._v("#")]),e._v(" 客户端")]),e._v(" "),s("p",[s("a",{attrs:{href:"http://github.com/obgm/libcoap",target:"_blank",rel:"noopener noreferrer"}},[e._v("libcoap"),s("OutboundLink")],1),e._v(" 是一个非常易用的 CoAP 客户端库，此处我们使用它作为 CoAP 客户端来测试 EMQX CoAP 接入网关的功能。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git clone http://github.com/obgm/libcoap\ncd libcoap\n./autogen.sh\n./configure --enable-documentation=no --enable-tests=no\nmake\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("h3",{attrs:{id:"publish-示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#publish-示例"}},[e._v("#")]),e._v(" PUBLISH 示例")]),e._v(" "),s("p",[e._v("使用 "),s("code",[e._v("libcoap")]),e._v(" 发布一条消息：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("libcoap/examples/coap-client -m put -e "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1234")]),e._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"coap://127.0.0.1/mqtt/topic1?c=client1&u=tom&p=secret"')]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v('主题名称为："topic1"  (不是 "/topic1")')]),e._v(" "),s("li",[e._v('Client ID 为："client1"')]),e._v(" "),s("li",[e._v('用户名为："tom"')]),e._v(" "),s("li",[e._v('密码为："secret"')]),e._v(" "),s("li",[e._v('Payload 为："1234"')])]),e._v(" "),s("h3",{attrs:{id:"subscribe-示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#subscribe-示例"}},[e._v("#")]),e._v(" SUBSCRIBE 示例")]),e._v(" "),s("p",[e._v("使用 "),s("code",[e._v("libcoap")]),e._v(" 订阅一个主题：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('libcoap/examples/coap-client -m get -s 10 "coap://127.0.0.1/mqtt/topic1?c=client1&u=tom&p=secret"\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v('主题名称为："topic1"  (不是 "/topic1")')]),e._v(" "),s("li",[e._v('Client ID 为："client1"')]),e._v(" "),s("li",[e._v('用户名为："tom"')]),e._v(" "),s("li",[e._v('密码为："secret"')]),e._v(" "),s("li",[e._v("订阅的持续时间为：10 秒")])]),e._v(" "),s("p",[e._v("在这个期间，如果 "),s("code",[e._v("topic1")]),e._v(" 主题上有消息产生，"),s("code",[e._v("libcoap")]),e._v(" 便会收到该条消息。")]),e._v(" "),s("h3",{attrs:{id:"通信接口说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通信接口说明"}},[e._v("#")]),e._v(" 通信接口说明")]),e._v(" "),s("h4",{attrs:{id:"coap-client-observe-operation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coap-client-observe-operation"}},[e._v("#")]),e._v(" CoAP Client Observe Operation")]),e._v(" "),s("p",[e._v("在 EMQX CoAP 接入网关中，可以使用 CoAP 的 Observe 操作实现一个订阅主题的操作：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("GET  coap://localhost/mqtt/{topicname}?c={clientid}&u={username}&p={password}    with OBSERVE=0\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v('路径中的 "mqtt "为必填项')]),e._v(" "),s("li",[e._v("将 {topicname}、{clientid}、{username} 和 {password} 替换为你的真实值")]),e._v(" "),s("li",[e._v("{topicname} 和 {clientid} 为必填项")]),e._v(" "),s("li",[e._v('如果 clientid 不存在，将返回 "bad_request"')]),e._v(" "),s("li",[e._v("URI 中的 {topicname} 应该用 percent-encoded，以防止特殊字符，如 + 和 #")]),e._v(" "),s("li",[e._v("{username} 和 {password} 是可选的")]),e._v(" "),s("li",[e._v("如果 {username} 和 {password} 不正确，将返回一个 uauthorized 错误")]),e._v(" "),s("li",[e._v("订阅的 QoS 等级恒定为 1")])]),e._v(" "),s("h4",{attrs:{id:"coap-client-unobserve-operation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coap-client-unobserve-operation"}},[e._v("#")]),e._v(" CoAP Client Unobserve Operation")]),e._v(" "),s("p",[e._v("使用 Unobserve 操作，取消订阅主题：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("GET  coap://localhost/mqtt/{topicname}?c={clientid}&u={username}&p={password}    with OBSERVE=1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v('路径中的 "mqtt "为必填项')]),e._v(" "),s("li",[e._v("将 {topicname}、{clientid}、{username} 和 {password} 替换为你的真实值")]),e._v(" "),s("li",[e._v("{topicname} 和 {clientid} 为必填项")]),e._v(" "),s("li",[e._v('如果 clientid 不存在，将返回 "bad_request"')]),e._v(" "),s("li",[e._v("URI 中的 {topicname} 应该用 percent-encoded，以防止特殊字符，如 + 和 #")]),e._v(" "),s("li",[e._v("{username} 和 {password} 是可选的")]),e._v(" "),s("li",[e._v("如果 {username} 和 {password} 不正确，将返回一个 uauthorized 错误")])]),e._v(" "),s("h4",{attrs:{id:"coap-client-notification-operation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coap-client-notification-operation"}},[e._v("#")]),e._v(" CoAP Client Notification Operation")]),e._v(" "),s("p",[e._v("接入网关会将订阅主题上收到到消息，以 "),s("code",[e._v("observe-notification")]),e._v(" 的方式投递到 CoAP 客户端：")]),e._v(" "),s("ul",[s("li",[e._v("它的 payload 正是 MQTT 消息中的的 payload")]),e._v(" "),s("li",[e._v('payload 数据类型为 "application/octet-stream"')])]),e._v(" "),s("h4",{attrs:{id:"coap-client-publish-operation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coap-client-publish-operation"}},[e._v("#")]),e._v(" CoAP Client Publish Operation")]),e._v(" "),s("p",[e._v("使用 CoAP 的 PUT 命令执行一次 PUBLISH 操作：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("PUT  coap://localhost/mqtt/{topicname}?c={clientid}&u={username}&p={password}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v('路径中的 "mqtt "为必填项')]),e._v(" "),s("li",[e._v("将 {topicname}、{clientid}、{username} 和 {password} 替换为你的真实值")]),e._v(" "),s("li",[e._v("{topicname} 和 {clientid} 为必填项")]),e._v(" "),s("li",[e._v('如果 clientid 不存在，将返回 "bad_request"')]),e._v(" "),s("li",[e._v("URI 中的 {topicname} 应该用 percent-encoded，以防止特殊字符，如 + 和 #")]),e._v(" "),s("li",[e._v("{username} 和 {password} 是可选的")]),e._v(" "),s("li",[e._v("如果 {username} 和 {password} 不正确，将返回一个 uauthorized 错误")]),e._v(" "),s("li",[e._v("payload 可以是任何二进制数据")]),e._v(" "),s("li",[e._v('payload 数据类型为 "application/octet-stream"')]),e._v(" "),s("li",[e._v("发布信息将以 qos0 发送")])]),e._v(" "),s("h4",{attrs:{id:"coap-client-保活"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#coap-client-保活"}},[e._v("#")]),e._v(" CoAP Client 保活")]),e._v(" "),s("p",[e._v("设备应定期发出 GET 命令，作为 ping 操作保持会话在线")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("GET  coap://localhost/mqtt/{any_topicname}?c={clientid}&u={username}&p={password}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("ul",[s("li",[e._v('路径中的 "mqtt "为必填项')]),e._v(" "),s("li",[e._v("将 {topicname}、{clientid}、{username} 和 {password} 替换为你的真实值")]),e._v(" "),s("li",[e._v("{topicname} 和 {clientid} 为必填项")]),e._v(" "),s("li",[e._v('如果 clientid 不存在，将返回 "bad_request"')]),e._v(" "),s("li",[e._v("URI 中的 {topicname} 应该用 percent-encoded，以防止特殊字符，如 + 和 #")]),e._v(" "),s("li",[e._v("{username} 和 {password} 是可选的")]),e._v(" "),s("li",[e._v("如果 {username} 和 {password} 不正确，将返回一个 uauthorized 错误")]),e._v(" "),s("li",[e._v("客户端应该定期做 keepalive 工作，以保持会话在线，尤其是在 NAT 网络中的设备")])]),e._v(" "),s("h3",{attrs:{id:"备注"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备注"}},[e._v("#")]),e._v(" 备注")]),e._v(" "),s("p",[e._v("CoAP 接入网关不支持 "),s("code",[e._v("POST")]),e._v(" 和 "),s("code",[e._v("DELETE")]),e._v(" 方法。")]),e._v(" "),s("p",[e._v("在 URI 中的主题名称必须先经过 URI 编码处理(参考：RFC 7252 - section 6.4)")]),e._v(" "),s("p",[e._v("CoAP URI 中的 ClientId, Username, Password, Topic是 MQTT 中的概念。也就是说，CoAP 接入网关是通过借用 MQTT 中的名词概念，试图将 CoAP 信息融入到 MQTT 系统中。")]),e._v(" "),s("p",[e._v("EMQX 的 认证，访问控制，钩子等功能也适用于 CoAP 接入网关。比如：")]),e._v(" "),s("ul",[s("li",[e._v("如果 用户名/密码 没有被授权, CoAP 客户端就会得到一个 "),s("code",[e._v("uauthorized")]),e._v(" 的错误")]),e._v(" "),s("li",[e._v("如果 用户名/客户端ID 不允许发布特定的主题，CoAP 消息实际上会被丢弃，尽管 CoAP 客户端会从接入网关上得到一个 Acknoledgement")]),e._v(" "),s("li",[e._v("如果一个 CoAP 消息被发布，'message.publish' 钩子也能够捕获这个消息")])]),e._v(" "),s("h3",{attrs:{id:"well-known-locations"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#well-known-locations"}},[e._v("#")]),e._v(" Well-known locations")]),e._v(" "),s("hr"),e._v(" "),s("p",[e._v('CoAP 接入网关的 well-known 发现恒定的返回 "'),e._v(","),e._v('"')]),e._v(" "),s("p",[e._v("例如：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('libcoap/examples/coap-client -m get "coap://127.0.0.1/.well-known/core"\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])])])}),[],!1,null,null,null);a.default=i.exports},390:function(e,a,t){e.exports=t.p+"docs-assets/img/modules.89e07c9c.png"}}]);