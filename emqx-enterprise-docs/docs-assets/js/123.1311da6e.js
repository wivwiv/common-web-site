(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{1595:function(e,t,a){"use strict";a.r(t);var s=a(10),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"redis-authentication-acl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-authentication-acl"}},[e._v("#")]),e._v(" Redis Authentication/ACL")]),e._v(" "),s("p",[e._v("Redis Authentication/ACL uses an external Redis database as a data source, which can store large amounts of data and facilitate integration with external device management systems.")]),e._v(" "),s("p",[e._v("Set up the Redis environment, taking MacOS X as an example:")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v(" $ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" http://download.redis.io/releases/redis-4.0.14.tar.gz\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" xzf redis-4.0.14.tar.gz\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" redis-4.0.14\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Start redis")]),e._v("\n$ redis-server\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("h2",{attrs:{id:"create-module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-module"}},[e._v("#")]),e._v(" Create module")]),e._v(" "),s("p",[e._v("Open "),s("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("EMQX Dashboard"),s("OutboundLink")],1),e._v(', click the "Modules" tab on the left, and choose to add:')]),e._v(" "),s("p",[s("img",{attrs:{src:a(391),alt:"image-20200927213049265"}})]),e._v(" "),s("p",[e._v("Select Redis Authentication/ACL module")]),e._v(" "),s("p",[s("img",{attrs:{src:a(638),alt:"image-20200927213049265"}})]),e._v(" "),s("p",[e._v("Configure related parameters")]),e._v(" "),s("p",[s("img",{attrs:{src:a(639),alt:"image-20200927213049265"}})]),e._v(" "),s("p",[e._v("After clicking add, the module is added")]),e._v(" "),s("p",[s("img",{attrs:{src:a(640),alt:"image-20200927213049265"}})]),e._v(" "),s("h2",{attrs:{id:"authentication-default-data-structure"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authentication-default-data-structure"}},[e._v("#")]),e._v(" Authentication default data structure")]),e._v(" "),s("p",[e._v("In the default configuration of Redis authentication, a hash table is used to store authentication data, and "),s("code",[e._v("mqtt_user:")]),e._v(" is used as the Redis key prefix. The data structure is as follows:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("redis> hgetall mqtt_user:emqx\npassword public\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("The sample data in the default configuration is as follows:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("HMSET mqtt_user:emqx password public\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("After enabling Redis authentication, you can connect via username: emqx and password: public.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("This is the data structure used by the default configuration. After you are familiar with the use of this module, you can use any data structure that meets the conditions for authentication.")])]),e._v(" "),s("h2",{attrs:{id:"salting-rules-and-hashing-methods"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#salting-rules-and-hashing-methods"}},[e._v("#")]),e._v(" Salting rules and hashing methods")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("## No salt, plain text\nplain\n\n## No salt, only hash processing\nsha256\n\n## salt prefix: use sha256 to encrypt salt + password concatenated string\nsalt,sha256\n\n## salt suffix: use sha256 encrypted password + salt spliced ​​string\nsha256,salt\n\n## pbkdf2 with macfun iterations dklen\n## macfun: md4, md5, ripemd160, sha, sha224, sha256, sha384, sha512\npbkdf2,sha256,1000,20\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br")])]),s("h2",{attrs:{id:"authentication-query-command-auth-query-cmd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authentication-query-command-auth-query-cmd"}},[e._v("#")]),e._v(" Authentication query command (auth query cmd)")]),e._v(" "),s("p",[e._v("When performing identity authentication, EMQX will use the current client information to fill in and execute the authentication query command configured by the user to query the authentication data of the client in Redis.")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("HMGET mqtt_user:%u password\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("You can use the following placeholders in the command, and EMQX will automatically fill in the client information when executed:")]),e._v(" "),s("p",[e._v("-%u: username")]),e._v(" "),s("p",[e._v("-%c: Client ID")]),e._v(" "),s("p",[e._v("-%C: TLS certificate common name (domain name or subdomain name of the certificate), valid only when TLS connection")]),e._v(" "),s("p",[e._v("-%d: TLS certificate subject, valid only when TLS connection")]),e._v(" "),s("p",[e._v("You can adjust the authentication query command according to your business needs, and use any "),s("a",{attrs:{href:"http://redisdoc.com/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis supported command"),s("OutboundLink")],1),e._v(", but in any case, the authentication query command needs to meet the following conditions:")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("The first data in the query result must be password. EMQX uses this field to compare with the client password")])]),e._v(" "),s("li",[s("p",[e._v("If the salt configuration is enabled, the second data in the query result must be the salt field, and EMQX uses this field as the salt value")])])]),e._v(" "),s("h2",{attrs:{id:"access-control-default-data-structure"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#access-control-default-data-structure"}},[e._v("#")]),e._v(" Access control default data structure")]),e._v(" "),s("h3",{attrs:{id:"acl-rule-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acl-rule-data"}},[e._v("#")]),e._v(" ACL rule data")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("## Format\nHSET mqtt_acl:[username clientid][topic] [access]\n\n## Structure\nredis> hgetall mqtt_acl:emqx\ntesttopic/1 1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("Sample data in the default configuration:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("HSET mqtt_acl:emqx # 1\n\nHSET mqtt_acl:testtopic/2 2\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h2",{attrs:{id:"acl-query-command-acl-cmd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acl-query-command-acl-cmd"}},[e._v("#")]),e._v(" ACL query command (acl cmd)")]),e._v(" "),s("p",[e._v("When performing ACL authentication, EMQX will use the current client information to fill in and execute the super user command configured by the user. If the super user command is not enabled or the client is not a super user, the ACL query command will be used to query the client’s database in the database. ACL rules.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("HGETALL mqtt_acl:%u\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("You can use the following placeholders in ACL query commands, and EMQX will automatically fill in client information when executed:")]),e._v(" "),s("p",[e._v("-%u: username")]),e._v(" "),s("p",[e._v("-%c: Client ID")]),e._v(" "),s("p",[e._v("You can adjust the ACL query command according to your business needs, but in any case, the ACL query command needs to meet the following conditions:")]),e._v(" "),s("ol",[s("li",[e._v("Use topic as the key and access as the value in the hash")])]),e._v(" "),s("h2",{attrs:{id:"super-user-query-command-super-cmd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#super-user-query-command-super-cmd"}},[e._v("#")]),e._v(" Super user query command (super cmd)")]),e._v(" "),s("p",[e._v("When performing ACL authentication, EMQX will use the current client information to fill and execute the super user query command configured by the user to query whether the client is a super user. When the client is a super user, the ACL query command will be skipped.")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("HGET mqtt_user:%u is_superuser\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("You can use the following placeholders in the command, and EMQX will automatically fill in the client information when executed:")]),e._v(" "),s("p",[e._v("-%u: username")]),e._v(" "),s("p",[e._v("-%c: Client ID")]),e._v(" "),s("p",[e._v("-%C: TLS certificate common name (domain name or subdomain name of the certificate), valid only when TLS connection")]),e._v(" "),s("p",[e._v("-%d: TLS certificate subject, valid only when TLS connection")]),e._v(" "),s("p",[e._v("You can adjust super user query commands according to business needs, such as adding multiple query conditions and using database preprocessing functions to implement more business-related functions. But in any case, the super user query command needs to meet the following conditions:")]),e._v(" "),s("ol",[s("li",[e._v("The first data in the query result must be is_superuser data")])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("If the super user function is not needed, commenting and disabling this option can effectively improve efficiency")])])])}),[],!1,null,null,null);t.default=n.exports},391:function(e,t,a){e.exports=a.p+"docs-assets/img/modules.1814040c.png"},638:function(e,t,a){e.exports=a.p+"docs-assets/img/auth_redis2.6f60f65f.png"},639:function(e,t,a){e.exports=a.p+"docs-assets/img/auth_redis3.ea1a37d1.png"},640:function(e,t,a){e.exports=a.p+"docs-assets/img/auth_redis4.8b87206b.png"}}]);