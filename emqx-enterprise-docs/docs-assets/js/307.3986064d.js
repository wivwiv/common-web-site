(window.webpackJsonp=window.webpackJsonp||[]).push([[307],{1655:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"http-acl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-acl"}},[s._v("#")]),s._v(" HTTP ACL")]),s._v(" "),a("p",[s._v("HTTP 认证使用外部自建 HTTP 应用认证授权数据源，根据 HTTP API 返回的数据判定授权结果，能够实现复杂的 ACL 校验逻辑。")]),s._v(" "),a("p",[s._v("插件：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("emqx_auth_http\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("emqx_auth_http 插件同时包含认证功能，可通过注释禁用。")])]),s._v(" "),a("p",[s._v("要启用 HTTP ACL，需要在 "),a("code",[s._v("etc/plugins/emqx_auth_http.conf")]),s._v(" 中配置以下内容：")]),s._v(" "),a("h2",{attrs:{id:"acl-授权原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acl-授权原理"}},[s._v("#")]),s._v(" ACL 授权原理")]),s._v(" "),a("p",[s._v("EMQX 在设备发布、订阅事件中使用当前客户端相关信息作为参数，向用户自定义的认证服务发起请求权限，通过返回的 HTTP "),a("strong",[s._v("响应状态码")]),s._v(" (HTTP statusCode) 来处理 ACL 授权请求。")]),s._v(" "),a("ul",[a("li",[s._v("无权限：API 返回分 200 状态码")]),s._v(" "),a("li",[s._v("授权成功：API 返回 200 状态码")]),s._v(" "),a("li",[s._v("忽略授权：API 返回 200 状态码且消息体 ignore")])]),s._v(" "),a("h2",{attrs:{id:"http-请求信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-请求信息"}},[s._v("#")]),s._v(" HTTP 请求信息")]),s._v(" "),a("p",[s._v("HTTP API 基础请求信息，配置证书、请求头与重试规则。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etc/plugins/emqx_auth_http.conf")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 启用 HTTPS 所需证书信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.http.ssl.cacertfile = etc/certs/ca.pem")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.http.ssl.certfile = etc/certs/client-cert.pem")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.http.ssl.keyfile = etc/certs/client-key.pem")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 请求头设置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## auth.http.header.Accept = */*")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 重试设置")]),s._v("\nauth.http.request.retry_times "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\nauth.http.request.retry_interval "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 1s\n\nauth.http.request.retry_backoff "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("进行发布、订阅认证时，EMQX 将使用当前客户端信息填充并发起用户配置的 ACL 授权查询请求，查询出该客户端在 HTTP 服务器端的授权数据。")]),s._v(" "),a("h2",{attrs:{id:"superuser-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#superuser-请求"}},[s._v("#")]),s._v(" superuser 请求")]),s._v(" "),a("p",[s._v("首先查询客户端是否为超级用户，客户端为超级用户时将跳过 ACL 查询。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etc/plugins/emqx_auth_http.conf")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 请求地址")]),s._v("\nauth.http.super_req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" http://127.0.0.1:8991/mqtt/superuser\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## HTTP 请求方法")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Value: post | get | put")]),s._v("\nauth.http.super_req.method "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" post\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 请求参数")]),s._v("\nauth.http.super_req.params "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("clientid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%c,username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%u\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"acl-授权查询请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acl-授权查询请求"}},[s._v("#")]),s._v(" ACL 授权查询请求")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etc/plugins/emqx_auth_http.conf")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 请求地址")]),s._v("\nauth.http.acl_req "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" http://127.0.0.1:8991/mqtt/acl\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## HTTP 请求方法")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Value: post | get | put")]),s._v("\nauth.http.acl_req.method "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 请求参数")]),s._v("\nauth.http.acl_req.params "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("access")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%A,username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%u,clientid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%c,ipaddr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%a,topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%t,mountpoint"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("%m\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"请求说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求说明"}},[s._v("#")]),s._v(" 请求说明")]),s._v(" "),a("p",[s._v("HTTP 请求方法为 GET 时，请求参数将以 URL 查询字符串的形式传递；POST、PUT 请求则将请求参数以普通表单形式提交（content-type 为 x-www-form-urlencoded）。")]),s._v(" "),a("p",[s._v("你可以在认证请求中使用以下占位符，请求时 EMQX 将自动填充为客户端信息：")]),s._v(" "),a("ul",[a("li",[s._v("%A：操作类型，'1' 订阅；'2' 发布")]),s._v(" "),a("li",[s._v("%u：客户端用户名")]),s._v(" "),a("li",[s._v("%c：Client ID")]),s._v(" "),a("li",[s._v("%a：客户端 IP 地址")]),s._v(" "),a("li",[s._v("%r：客户端接入协议")]),s._v(" "),a("li",[s._v("%m：Mountpoint")]),s._v(" "),a("li",[s._v("%t：主题")])]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),a("p",[s._v("推荐使用 POST 与 PUT 方法，使用 GET 方法时明文密码可能会随 URL 被记录到传输过程中的服务器日志中。")])])])}),[],!1,null,null,null);t.default=n.exports}}]);