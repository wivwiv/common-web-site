(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{1576:function(e,s,a){"use strict";a.r(s);var t=a(10),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"kafka-consumer-group"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka-consumer-group"}},[e._v("#")]),e._v(" Kafka Consumer Group")]),e._v(" "),t("p",[e._v("The Kafka consumer group uses external Kafka as a message queue, which can convert consumer messages from Kafka into MQTT messages and publish them in emqx.")]),e._v(" "),t("p",[e._v("Set up the Kafka environment, taking MacOS X as an example:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" https://archive.apache.org/dist/kafka/2.8.0/kafka_2.13-2.8.0.tgz\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -xzf  kafka_2.13-2.8.0.tgz\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" kafka_2.13-2.8.0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Start Zookeeper")]),e._v("\n$ ./bin/zookeeper-server-start.sh config/zookeeper.properties\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Start Kafka")]),e._v("\n$ ./bin/kafka-server-start.sh config/server.properties\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[e._v("WARING")]),e._v(" "),t("p",[e._v("Kafka consumer groups do not support Kafka versions below 0.9")]),e._v(" "),t("p",[e._v("Before creating resources, you need to create Kafka topics in advance, otherwise an error will be prompted")])]),e._v(" "),t("p",[e._v("Create Kafka topic:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ ./bin/kafka-topics.sh --zookeeper localhost:2181 --replication-factor "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" --partitions "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" --topic testTopic --create\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"create-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-module"}},[e._v("#")]),e._v(" Create module")]),e._v(" "),t("p",[e._v("Open "),t("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("EMQX Dashboard"),t("OutboundLink")],1),e._v(', click the "Modules" tab on the left, and choose to add:')]),e._v(" "),t("p",[e._v("Select Kafka consumer group module:")]),e._v(" "),t("p",[t("img",{attrs:{src:a(391),alt:""}})]),e._v(" "),t("p",[e._v('Click "Select", and then select "Kafka Consumer Group":')]),e._v(" "),t("p",[t("img",{attrs:{src:a(573),alt:""}})]),e._v(" "),t("p",[e._v("Fill in the relevant parameters:")]),e._v(" "),t("p",[t("img",{attrs:{src:a(574),alt:""}})]),e._v(" "),t("p",[e._v("1). Kafka server address")]),e._v(" "),t("p",[e._v("2). Kafka consumer connection pool size")]),e._v(" "),t("p",[e._v("3). Kafka subscription topic")]),e._v(" "),t("p",[e._v("4). MQTT message subject")]),e._v(" "),t("p",[e._v("5). MQTT topic service quality")]),e._v(" "),t("p",[e._v("6). Kafka Max Bytes (the maximum number of bytes of messages consumed each time from Kafka)")]),e._v(" "),t("p",[e._v("7). Kafka Offset Reset Policy (reset Offset policy, reset_to_latest | reset_by_subdcriber)")]),e._v(" "),t("p",[e._v("7). Is Kafka consumer reconnected?")]),e._v(" "),t("p",[e._v("After clicking Add, the module is added:")]),e._v(" "),t("p",[t("img",{attrs:{src:a(575),alt:""}})]),e._v(" "),t("p",[e._v('The resource has been created, now use Dashboard\'s websocket tool to subscribe to the MQTT topic "TestTopic":')]),e._v(" "),t("p",[t("img",{attrs:{src:a(576),alt:""}})]),e._v(" "),t("p",[e._v("Use the kafka command line to produce a message:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("./bin/kafka-console-producer.sh --broker-list localhost:9092 --topic TestTopic\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:a(577),alt:""}})]),e._v(" "),t("p",[e._v('The websocket tool of Dashboard received the message "hello-kafka" produced by Kafka:')]),e._v(" "),t("p",[t("img",{attrs:{src:a(578),alt:""}})])])}),[],!1,null,null,null);s.default=r.exports},391:function(e,s,a){e.exports=a.p+"docs-assets/img/modules.1814040c.png"},573:function(e,s,a){e.exports=a.p+"docs-assets/img/kafka_consumer2.ca6e5441.png"},574:function(e,s,a){e.exports=a.p+"docs-assets/img/kafka_consumer3.30caba96.png"},575:function(e,s,a){e.exports=a.p+"docs-assets/img/kafka_consumer4.bd48dc00.png"},576:function(e,s,a){e.exports=a.p+"docs-assets/img/kafka_consumer5.f462fe28.png"},577:function(e,s,a){e.exports=a.p+"docs-assets/img/kafka_consumer6.f4fe2fc3.png"},578:function(e,s,a){e.exports=a.p+"docs-assets/img/kafka_consumer7.4a2cef7e.png"}}]);