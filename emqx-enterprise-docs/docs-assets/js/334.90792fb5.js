(window.webpackJsonp=window.webpackJsonp||[]).push([[334],{1692:function(s,a,e){"use strict";e.r(a);var n=e(10),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"版本热升级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#版本热升级"}},[s._v("#")]),s._v(" 版本热升级")]),s._v(" "),e("p",[s._v("自 4.2.0 版本之后，EMQX Broker 支持版本热升级。")]),s._v(" "),e("p",[s._v("使用版本热升级功能，用户可以快速、安全地升级生产环境的 EMQX Broker，并避免了因重启服务导致的系统可用性降低。")]),s._v(" "),e("p",[s._v("目前 EMQX Broker 仅支持 Patch 版本（Patch 版本是版本号的第三位）的热升级。\n即，目前支持 4.2.0 -> 4.2.1，4.2.0 -> 4.2.2，... 等的热升级，但 4.2.x 无法热升级到 4.3.0 或者 5.0。")]),s._v(" "),e("p",[s._v("目前 Windows、MacOSX 暂不支持热升级功能。")]),s._v(" "),e("h2",{attrs:{id:"热升级步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#热升级步骤"}},[s._v("#")]),s._v(" 热升级步骤")]),s._v(" "),e("ol",[e("li",[s._v("查看当前已安装的 EMQX Broker 的版本列表。")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ emqx versions\n\nInstalled versions:\n* "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0\tpermanent\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("从 EMQX 官网下载要升级的软件包。")])]),s._v(" "),e("p",[s._v("访问 "),e("a",{attrs:{href:"https://www.emqx.com/en/downloads?product=broker",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.emqx.com/en/downloads?product=broker"),e("OutboundLink")],1),s._v(" 选择对应的版本和操作系统类型，然后选择 "),e("strong",[s._v('"zip"')]),s._v(" 包类型。")]),s._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[s._v("找到 EMQX 的安装目录：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EMQX_ROOT_DIR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("emqx root_dir"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EMQX_ROOT_DIR}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/lib/emqx"')]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("将下载的 zip 包放到 EMQX 安装目录下的 "),e("code",[s._v("releases")]),s._v(" 目录下：")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" emqx-4.2.1.zip "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${EMQX_ROOT_DIR}")]),s._v("/releases/\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[s._v("升级到指定版本:")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ emqx upgrade "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1\n\nRelease "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1 not found, attempting to unpack releases/emqx-4.2.1.tar.gz\nUnpacked successfully: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4.2.1"')]),s._v("\nInstalled Release: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1\nMade release permanent: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4.2.1"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ol",{attrs:{start:"6"}},[e("li",[s._v("再次查看版本列表，之前的版本的状态将会变成 "),e("code",[s._v("old")]),s._v(":")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ emqx versions\n\nInstalled versions:\n* "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1\tpermanent\n* "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0\told\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"升级后手动持久化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#升级后手动持久化"}},[s._v("#")]),s._v(" 升级后手动持久化")]),s._v(" "),e("p",[s._v("上面的 "),e("code",[s._v("emqx upgrade 4.2.1")]),s._v(" 命令其实执行了三个动作:")]),s._v(" "),e("ul",[e("li",[s._v("解压 zip 包 ("),e("code",[s._v("unpack")]),s._v(")")]),s._v(" "),e("li",[s._v("安装 ("),e("code",[s._v("install")]),s._v(")")]),s._v(" "),e("li",[s._v("持久化 ("),e("code",[s._v("permanent")]),s._v(")")])]),s._v(" "),e("p",[s._v("持久化之后，这次版本升级将会被固定下来，这意味着热升级后，如果 emqx 发生重启，使用的将是升级之后的新版本。\n如果不想在升级的同时持久化，可以使用 "),e("code",[s._v("--no-permanent")]),s._v(" 参数：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ emqx upgrade --no-permanent "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1\n\nRelease "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1 not found, attempting to unpack releases/emqx-4.2.1.tar.gz\nUnpacked successfully: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4.2.1"')]),s._v("\nInstalled Release: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v('这时版本已经成功升级到了 4.2.1，但如果重启 emqx，将会还原到旧版本 4.2.0。\n现在如果查看版本列表，会发现 4.2.1 的状态为 "当前版本"('),e("code",[s._v("current")]),s._v(")，而不是持久化版本：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ emqx versions\n\nInstalled versions:\n* "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1\tcurrent\n* "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0\tpermanent\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("在系统稳定运行一段时间后，若决定持久化新版本，可以再次执行 "),e("code",[s._v("install")]),s._v(" 命令：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ emqx "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1\n\nRelease "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".1 is already installed and current, making permanent.\nMade release permanent: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4.2.1"')]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"版本降级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#版本降级"}},[s._v("#")]),s._v(" 版本降级")]),s._v(" "),e("p",[s._v("如果升级后发现问题想要回退，可以执行版本降级命令。\n比如下面的例子会将 emqx 回退到 4.2.0 版本:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ emqx downgrade "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0\n\nRelease "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0 is marked old, switching to it.\nInstalled Release: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0\nMade release permanent: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4.2.0"')]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"删除版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除版本"}},[s._v("#")]),s._v(" 删除版本")]),s._v(" "),e("p",[s._v("在系统稳定运行一段时间后，若决定删除一个旧版本，可以执行版本卸载命令。\n比如下面的例子将会卸载旧版本的 4.2.0:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("\n$ emqx uninstall "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0\n\nRelease "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0 is marked old, uninstalling it.\nUninstalled Release: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(".0\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);