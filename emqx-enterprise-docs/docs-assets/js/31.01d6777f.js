(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{1597:function(s,a,t){"use strict";t.r(a);var e=t(10),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"save-data-to-cassandra"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#save-data-to-cassandra"}},[s._v("#")]),s._v(" Save data to Cassandra")]),s._v(" "),e("p",[s._v("Setup a Cassandra database, and changes the root/password to root/public, taking Mac OSX for instance:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ brew "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" cassandra\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## change the config file to enable authentication")]),s._v("\n$  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/etc/cassandra/cassandra.yaml\n\n    authenticator: PasswordAuthenticator\n    authorizer: CassandraAuthorizer\n\n$ brew services start cassandra\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## login to cql shell and then create the root user")]),s._v("\n$ cqlsh -ucassandra -pcassandra\n\ncassandra@cqlsh"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" create user root with password "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'public'")]),s._v(" superuser"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("Initiate Cassandra Table:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ cqlsh -uroot -ppublic\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v('Create Keyspace "test":')]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("CREATE KEYSPACE "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" WITH replication "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SimpleStrategy'")]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'replication_factor'")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  AND durable_writes "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v('Create "t_mqtt_msg" table:')]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("USE "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nCREATE TABLE t_mqtt_msg "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    msgid text,\n    topic text,\n    qos int,\n    payload text,\n    retain int,\n    arrived timestamp,\n    PRIMARY KEY "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msgid, topic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("Create a rule:")]),s._v(" "),e("p",[s._v("Go to "),e("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[s._v("EMQX Dashboard"),e("OutboundLink")],1),s._v(', select the\n"rule" tab on the menu to the left.')]),s._v(" "),e("p",[s._v('Select "message.publish", then type in the following SQL:')]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("SELECT\n    *\nFROM\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message.publish"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("img",{attrs:{src:t(393),alt:"image"}})]),s._v(" "),e("p",[s._v("Bind an action:")]),s._v(" "),e("p",[s._v('Click on the "+ Add" button under "Action Handler", and then select\n"Data to Cassandra" in the pop-up dialog window.')]),s._v(" "),e("p",[e("img",{attrs:{src:t(647),alt:"image"}})]),s._v(" "),e("p",[s._v("Fill in the parameters required by the action:")]),s._v(" "),e("p",[s._v('Two parameters is required by action "Data to Cassandra":')]),s._v(" "),e("p",[s._v("1). SQL template. SQL template is the sql command you'd like to run\nwhen the action is triggered. In this example we'll insert a message\ninto Cassandra, so type in the following sql\ntemplate:")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" t_mqtt_msg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msgid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" topic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" qos"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" retain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" arrived"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("${id}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${topic}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${qos}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${payload}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${retain}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ${"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),s._v("}"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Before data is inserted into the table, placeholders like ${key} will\nbe replaced by the corresponding values.")]),s._v(" "),e("p",[e("img",{attrs:{src:t(648),alt:"image"}})]),s._v(" "),e("p",[s._v('2). Bind a resource to the action. Since the dropdown list "Resource"\nis empty for now, we create a new resource by clicking on the "New\nResource" to the top right, and then select "Cassandra":')]),s._v(" "),e("p",[e("img",{attrs:{src:t(649),alt:"image"}})]),s._v(" "),e("p",[s._v("Configure the resource:")]),s._v(" "),e("p",[s._v('Set "Cassandra Keyspace" to "test", "Cassandra Username" to "root",\n"Cassandra Password" to "public", and keep all other configs as\ndefault, and click on the "Testing Connection" button to make sure the\nconnection can be created successfully.')]),s._v(" "),e("p",[e("img",{attrs:{src:t(650),alt:"image"}})]),s._v(" "),e("p",[s._v('Then click on the "Create" button.')]),s._v(" "),e("p",[s._v('Back to the "Actions" dialog, and then click on the "Confirm" button.')]),s._v(" "),e("p",[e("img",{attrs:{src:t(651),alt:"image"}})]),s._v(" "),e("p",[s._v('Back to the creating rule page, then click on "Create" button. The rule we created will be show in the rule list:')]),s._v(" "),e("p",[e("img",{attrs:{src:t(652),alt:"image"}})]),s._v(" "),e("p",[s._v("We have finished, testing the rule by sending an MQTT message to emqx:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Topic: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t/cass"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" QoS: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Retained: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Payload: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("Then inspect the Cassandra table, verify a new record has been\ninserted:")]),s._v(" "),e("p",[e("img",{attrs:{src:t(653),alt:"image"}})]),s._v(" "),e("p",[s._v('And from the rule list, verify that the "Matched" column has increased\nto 1:')]),s._v(" "),e("p",[e("img",{attrs:{src:t(654),alt:"image"}})])])}),[],!1,null,null,null);a.default=n.exports},393:function(s,a,t){s.exports=t.p+"docs-assets/img/mysql_sql_1.515176ea.png"},647:function(s,a,t){s.exports=t.p+"docs-assets/img/cass_action_0.36843091.png"},648:function(s,a,t){s.exports=t.p+"docs-assets/img/cass_action_1.9f93eea3.png"},649:function(s,a,t){s.exports=t.p+"docs-assets/img/cass_action_2.d4b65c6d.png"},650:function(s,a,t){s.exports=t.p+"docs-assets/img/cass_resoure_1.37ffe172.png"},651:function(s,a,t){s.exports=t.p+"docs-assets/img/cass_action_3.1f3b6184.png"},652:function(s,a,t){s.exports=t.p+"docs-assets/img/cass_rule_overview_0.677a3bd1.png"},653:function(s,a,t){s.exports=t.p+"docs-assets/img/cass_result.62ab053a.png"},654:function(s,a,t){s.exports=t.p+"docs-assets/img/cass_rule_overview_1.63639449.png"}}]);