(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{1172:function(s,t,a){s.exports=a.p+"docs-assets/img/HStream.01b165c3.png"},1173:function(s,t,a){s.exports=a.p+"docs-assets/img/create_resource.0755bcc4.png"},1174:function(s,t,a){s.exports=a.p+"docs-assets/img/create_rule.5393c9d0.png"},1175:function(s,t,a){s.exports=a.p+"docs-assets/img/send_msg.cc2a8c2d.png"},1176:function(s,t,a){s.exports=a.p+"docs-assets/img/rule_res.e6e50075.png"},1798:function(s,t,a){"use strict";a.r(t);var e=a(10),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"保存数据到-hstreamdb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#保存数据到-hstreamdb"}},[s._v("#")]),s._v(" 保存数据到 HStreamDB")]),s._v(" "),e("p",[s._v("HStreamDB 是一款专为流式数据设计的， 针对大规模实时数据流的接入、存储、处理、 分发等环节进行全生命周期管理的流数据库。它使用标准 SQL (及其流式拓展）作为主要接口语言，以实时性作为主要特征，旨在简化数据流的运维管理以及实时应用的开发")]),s._v(" "),e("p",[e("img",{attrs:{src:a(1172),alt:"image"}})]),s._v(" "),e("p",[s._v("更多详细信息，请参考"),e("a",{attrs:{href:"https://hstream.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("HStream官网"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("h2",{attrs:{id:"创建-hstreamdb-服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-hstreamdb-服务"}},[s._v("#")]),s._v(" 创建 HStreamDB 服务")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://hstream.io/docs/en/latest/start/quickstart-with-docker.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("部署参考文档"),e("OutboundLink")],1),s._v("，可使用 docker 本地部署，或云主机部署。\n使用命令创建出 hstream-client :")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker run -it --rm --name some-hstream-cli --network "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" hstreamdb/hstream:v0.8.0 hstream-client --port "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6570")]),s._v(" --client-id "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("进入控制台")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("      __  _________________  _________    __  ___\n     / / / / ___/_  __/ __ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("/ ____/   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  /  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("/  /\n    / /_/ /"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("__ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" / / / /_/ / __/ / /"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" / /"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("_/ /\n   / __  /___/ // / / _, _/ /___/ ___ "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("/ /  / /\n  /_/ /_//____//_/ /_/ "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("_/_____/_/  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("_/_/  /_/\n\n\nCommand\n  :h                           To show these "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" info\n  :q                           To "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line interface\n  :help "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sql_operation"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("        To show full usage of sql statement\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("创建 stream：")]),s._v(" "),e("div",{staticClass:"language-SQL line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" STREAM demo_stream"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndemo_stream\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" STREAMS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndemo_stream\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"创建-hstreamdb-资源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-hstreamdb-资源"}},[s._v("#")]),s._v(" 创建 HStreamDB 资源")]),s._v(" "),e("p",[s._v("进入 EMQX Dashboard，点击右侧 "),e("code",[s._v("规则引擎")]),s._v(" > "),e("code",[s._v("资源")]),s._v(" > "),e("code",[s._v("创建")]),s._v("，选取 HStreamDB 资源，输入资源地址与链接池。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(1173),alt:"image"}})]),s._v(" "),e("h2",{attrs:{id:"创建规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建规则"}},[s._v("#")]),s._v(" 创建规则")]),s._v(" "),e("p",[s._v("点击，"),e("code",[s._v("规则引擎")]),s._v(" > "),e("code",[s._v("规则")]),s._v(" > "),e("code",[s._v("创建")]),s._v("。\n编辑规则 SQL：")]),s._v(" "),e("div",{staticClass:"language-SQL line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n\n  payload\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("文档中的规则 SQL 仅作为示例，请按照业务设计编写 SQL。")]),s._v(" "),e("p",[s._v("点击添加动作，选择数据持久化，保存数据到 HSTreamDB。\n选择上一步中创建的资源，并输入参数，参数定义见下表：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("参数名")]),s._v(" "),e("th",[s._v("定义")]),s._v(" "),e("th",[s._v("类型")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("Stream")]),s._v(" "),e("td",[s._v("Stream 名称，不可使用变量")]),s._v(" "),e("td",[s._v("String")])]),s._v(" "),e("tr",[e("td",[s._v("Ordering Key")]),s._v(" "),e("td",[s._v("分区键，可使用变量")]),s._v(" "),e("td",[s._v("String")])]),s._v(" "),e("tr",[e("td",[s._v("启用批量插入")]),s._v(" "),e("td",[s._v("开启或关闭批量写入，默认开启")]),s._v(" "),e("td",[s._v("Boolean")])]),s._v(" "),e("tr",[e("td",[s._v("最大批量数")]),s._v(" "),e("td",[s._v("批量最大消息条目数量")]),s._v(" "),e("td",[s._v("Integer")])]),s._v(" "),e("tr",[e("td",[s._v("最大批量间隔(ms)")]),s._v(" "),e("td",[s._v("批量最大间隔，单位毫秒")]),s._v(" "),e("td",[s._v("Integer")])]),s._v(" "),e("tr",[e("td",[s._v("消息内容模板")]),s._v(" "),e("td",[s._v("写入的消息报文内容")]),s._v(" "),e("td",[s._v("Binary")])])])]),s._v(" "),e("p",[s._v("点击确定，创建。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(1174),alt:"image"}})]),s._v(" "),e("p",[s._v("现在使用 MQTT 桌面客户端 "),e("code",[s._v("MQTTX")]),s._v(" 连接至 EMQX，发送一条数据。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(1175),alt:"image"}})]),s._v(" "),e("p",[s._v("点击规则监控")]),s._v(" "),e("p",[e("img",{attrs:{src:a(1176),alt:"image"}})]),s._v(" "),e("p",[s._v("这时数据已经写入 HStreamDB，使用任意消费方式，将消息消费出来。文档中使用的是基于 HStream golang SDK 编写的简单消费工具 "),e("a",{attrs:{href:"https://github.com/hstreamdb/fetcher",target:"_blank",rel:"noopener noreferrer"}},[s._v("fetcher"),e("OutboundLink")],1),s._v("，读者可自行按照熟悉的编程语言编写消费端。可见消费日志如下：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("./fetcher -s f1 -n demo_stream -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6570 -c cons1 -v\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ts"')]),s._v(":1656311005.5250711,"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[f1]"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"recordId"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[BatchId: 8589934593, BatchIndex: 0, ShardId: 1317059070792293]"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payload"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello HSreamDB !"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("消息已经成功写入，并被消费完成。")])])}),[],!1,null,null,null);t.default=r.exports}}]);