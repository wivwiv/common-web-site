(window.webpackJsonp=window.webpackJsonp||[]).push([[177],{1059:function(s,t,a){s.exports=a.p+"docs-assets/img/acl_file3.3457ecc6.png"},1770:function(s,t,a){"use strict";a.r(t);var n=a(10),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"acl-file-访问控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#acl-file-访问控制"}},[s._v("#")]),s._v(" ACL File 访问控制")]),s._v(" "),n("p",[s._v("内置 ACL 通过文件设置规则，使用上足够简单轻量，适用于规则数量可预测、无变动需求或变动较小的项目。")]),s._v(" "),n("h2",{attrs:{id:"创建模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建模块"}},[s._v("#")]),s._v(" 创建模块")]),s._v(" "),n("p",[s._v("内置访问控制模块默认启动，可以通过dashboard页面进行停止和更新，但不可以删除。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(390),alt:"image-20200927213049265"}})]),s._v(" "),n("p",[s._v("直接编辑ACL文件，或选择具体配置文件进行替换")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1059),alt:"image-20200927213049265"}})]),s._v(" "),n("h2",{attrs:{id:"定义-acl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#定义-acl"}},[s._v("#")]),s._v(" 定义 ACL")]),s._v(" "),n("p",[s._v("内置 ACL 是优先级最低规则表，在所有的 ACL 检查完成后，如果仍然未命中则检查默认的 ACL 规则。")]),s._v(" "),n("p",[s._v("该规则文件以 Erlang 语法的格式进行描述：")]),s._v(" "),n("div",{staticClass:"language-erlang line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-erlang"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('%% 允许 "dashboard" 用户 订阅 "$SYS/#" 主题')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("allow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dashboard"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("subscribe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$SYS/#"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('%% 允许 IP 地址为 "127.0.0.1" 的用户 发布/订阅 "#SYS/#"，"#" 主题')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("allow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("ipaddr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("pubsub")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$SYS/#"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('%% 拒绝 "所有用户" 订阅 "$SYS/#" "#" 主题')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("deny")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("all")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("subscribe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$SYS/#"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("eq")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("%% 允许其它任意的发布订阅操作")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("allow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token atom"}},[s._v("all")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ol",[n("li",[n("p",[s._v("第一条规则允许客户端发布订阅所有主题")])]),s._v(" "),n("li",[n("p",[s._v("第二条规则禁止全部客户端订阅 "),n("code",[s._v("$SYS/#")]),s._v(" 与 "),n("code",[s._v("#")]),s._v(" 主题")])]),s._v(" "),n("li",[n("p",[s._v("第三条规则允许 ip 地址为 "),n("code",[s._v("127.0.0.1")]),s._v(" 的客户端发布/订阅 "),n("code",[s._v("$SYS/#")]),s._v(" 与 "),n("code",[s._v("#")]),s._v(" 主题，为第二条开了特例")])]),s._v(" "),n("li",[n("p",[s._v("第四条规则允许用户名为 "),n("code",[s._v("dashboard")]),s._v(" 的客户端订阅 "),n("code",[s._v("$SYS/#")]),s._v(" 主题，为第二条开了特例")])])]),s._v(" "),n("p",[s._v("可知，默认的 ACL 主要是为了限制客户端对系统主题 "),n("code",[s._v("$SYS/#")]),s._v(" 和全通配主题 "),n("code",[s._v("#")]),s._v(" 的权限。")]),s._v(" "),n("h2",{attrs:{id:"acl-conf-编写规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#acl-conf-编写规则"}},[s._v("#")]),s._v(" acl.conf 编写规则")]),s._v(" "),n("p",[n("code",[s._v("acl.conf")]),s._v(" 文件中的规则按书写顺序从上往下匹配。")]),s._v(" "),n("p",[n("code",[s._v("acl.conf")]),s._v(" 的语法规则包含在顶部的注释中，熟悉 Erlang 语法的可直接阅读文件顶部的注释。或参考以下的释义：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("以 "),n("code",[s._v("%%")]),s._v(" 表示行注释。")])]),s._v(" "),n("li",[n("p",[s._v("每条规则由四元组组成，以 "),n("code",[s._v(".")]),s._v(" 结束。")])]),s._v(" "),n("li",[n("p",[s._v("元组第一位：表示规则命中成功后，执行权限控制操作，可取值为：")])])]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v("allow")]),s._v("：表示 "),n("code",[s._v("允许")])]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v("deny")]),s._v("： 表示 "),n("code",[s._v("拒绝")])]),s._v(" "),n("ul",[n("li",[s._v("元组第二位：表示规则所生效的用户，可使用的格式为：")])]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v('{user, "dashboard"}')]),s._v("：表明规则仅对 "),n("em",[s._v("用户名 (Username)")]),s._v(' 为 "dashboard" 的用户生效')]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v('{client, "dashboard"}')]),s._v("：表明规则仅对 "),n("em",[s._v("客户端标识 (ClientId)")]),s._v(' 为 "dashboard" 的用户生效')]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v('{ipaddr, "127.0.0.1"}')]),s._v("：表明规则仅对 "),n("em",[s._v("源地址")]),s._v(' 为 "127.0.0.1" 的用户生效')]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v("all")]),s._v("：表明规则对所有的用户都生效")]),s._v(" "),n("ul",[n("li",[s._v("元组第三位：表示规则所控制的操作，可取值为：")])]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v("publish")]),s._v("：表明规则应用在 PUBLISH 操作上")]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v("subscribe")]),s._v("：表明规则应用在 SUBSCRIBE 操作上")]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v("pubsub")]),s._v("：表明规则对 PUBLISH 和 SUBSCRIBE 操作都有效")]),s._v(" "),n("ul",[n("li",[s._v("元组第四位：表示规则所限制的主题列表，内容以数组的格式给出，例如：")])]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v('"$SYS/#"')]),s._v("：为一个 "),n("strong",[s._v("主题过滤器 (Topic Filter)")]),s._v("；表示规则可命中与 "),n("code",[s._v("$SYS/#")]),s._v(' 匹配的主题；如：可命中 "$SYS/#"，也可命中 "$SYS/a/b/c"')]),s._v(" "),n("p",[s._v("​    * "),n("code",[s._v('{eq, "#"}')]),s._v("：表示字符的全等，规则仅可命中主题为 "),n("code",[s._v("#")]),s._v(" 的字串，不能命中 "),n("code",[s._v("/a/b/c")]),s._v(" 等")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("除此之外还存在两条特殊的规则：")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("{allow, all}")]),s._v("：允许所有操作")])]),s._v(" "),n("li",[n("p",[n("code",[s._v("{deny, all}")]),s._v("：拒绝所有操作")])])]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),n("p",[s._v("acl.conf 中应只包含一些简单而通用的规则，使其成为系统基础的 ACL 原则。如果需要支持复杂、大量的 ACL 内容可以选择外部资源去实现它。")])])])}),[],!1,null,null,null);t.default=e.exports},390:function(s,t,a){s.exports=a.p+"docs-assets/img/modules.89e07c9c.png"}}]);