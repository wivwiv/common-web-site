(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{1602:function(t,s,a){"use strict";a.r(s);var e=a(10),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"save-data-to-dynamodb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#save-data-to-dynamodb"}},[t._v("#")]),t._v(" Save data to DynamoDB")]),t._v(" "),e("p",[t._v("Setup a DynamoDB database, taking Mac OSX for instance:")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("$ brew "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" dynamodb-local\n\n$ dynamodb-local\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("Initiate the DynamoDB table:")]),t._v(" "),e("p",[t._v('1). Create table definition file "mqtt_msg.json" for DynamoDB:')]),t._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"TableName"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mqtt_msg"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"KeySchema"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"AttributeName"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msgid"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"KeyType"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HASH"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"AttributeDefinitions"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"AttributeName"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msgid"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"AttributeType"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"S"')]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ProvisionedThroughput"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ReadCapacityUnits"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WriteCapacityUnits"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("p",[t._v("2). Create the DynamoDB\ntable:")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$aws")]),t._v(" dynamodb create-table --cli-input-json file://mqtt_msg.json --endpoint-url http://localhost:8000\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("Create a rule:")]),t._v(" "),e("p",[t._v("Go to "),e("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("EMQX Dashboard"),e("OutboundLink")],1),t._v(', select the\n"rule" tab on the menu to the left.')]),t._v(" "),e("p",[t._v('Select "message.publish", then type in the following SQL:')]),t._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n     msgid "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" id"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" topic"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message.pubish"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[e("img",{attrs:{src:a(393),alt:"image"}})]),t._v(" "),e("p",[t._v("Bind an action:")]),t._v(" "),e("p",[t._v('Click on the "+ Add" button under "Action Handler", and then select\n"Data to DynamoDB" in the pop-up dialog window.')]),t._v(" "),e("p",[e("img",{attrs:{src:a(669),alt:"image"}})]),t._v(" "),e("p",[t._v("Fill in the parameters required by the action:")]),t._v(" "),e("p",[t._v('Four parameters is required by action "Data to DynamoDB":')]),t._v(" "),e("p",[t._v('1). DynamoDB Table. Here set it to "mqtt_msg".')]),t._v(" "),e("p",[t._v('2). Hash Key. Here set it to "msgid".')]),t._v(" "),e("p",[t._v("3). DynamoDB Range Key. Leave it empty as we didn't define a range key\nin the dynamodb definition file.")]),t._v(" "),e("p",[e("img",{attrs:{src:a(670),alt:"image"}})]),t._v(" "),e("p",[t._v('4). Bind a resource to the action. Since the dropdown list "Resource"\nis empty for now, we create a new resource by clicking on the "New\nResource" to the top right, and then select "DynamoDB":')]),t._v(" "),e("p",[e("img",{attrs:{src:a(671),alt:"image"}})]),t._v(" "),e("p",[t._v("Configure the resource:")]),t._v(" "),e("p",[t._v("Fill in the configs as following:")]),t._v(" "),e("ul",[e("li",[t._v("DynamoDB Region: us-west-2")]),t._v(" "),e("li",[t._v("DynamoDB Server: "),e("a",{attrs:{href:"http://localhost:8000",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://localhost:8000"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v('AWS Access Key Id: "AKIAU5IM2XOC7AQWG7HK"')]),t._v(" "),e("li",[t._v('AWS Secret Access Key: "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"')])]),t._v(" "),e("p",[t._v('And then click on the "Create" button.')]),t._v(" "),e("p",[e("img",{attrs:{src:a(672),alt:"image"}})]),t._v(" "),e("p",[t._v('Back to the "Actions" dialog, and then click on the "Confirm" button.')]),t._v(" "),e("p",[e("img",{attrs:{src:a(673),alt:"image"}})]),t._v(" "),e("p",[t._v('Back to the creating rule page, then click on "Create" button. The rule we created will be show in the rule list:')]),t._v(" "),e("p",[e("img",{attrs:{src:a(674),alt:"image"}})]),t._v(" "),e("p",[t._v("We have finished, testing the rule by sending an MQTT message to emqx:")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Topic: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"t/a"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" QoS: "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Payload: "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("p",[t._v("Then inspect the DynamoDB table, verify a new record has been\ninserted:")]),t._v(" "),e("p",[e("img",{attrs:{src:a(675),alt:"image"}})]),t._v(" "),e("p",[t._v('And from the rule list, verify that the "Matched" column has increased\nto 1:')]),t._v(" "),e("p",[e("img",{attrs:{src:a(676),alt:"image"}})])])}),[],!1,null,null,null);s.default=n.exports},393:function(t,s,a){t.exports=a.p+"docs-assets/img/mysql_sql_1.515176ea.png"},669:function(t,s,a){t.exports=a.p+"docs-assets/img/dynamo_action_0.be2c53aa.png"},670:function(t,s,a){t.exports=a.p+"docs-assets/img/dynamo_action_1.5d5e762b.png"},671:function(t,s,a){t.exports=a.p+"docs-assets/img/dynamo_action_2.5535e0aa.png"},672:function(t,s,a){t.exports=a.p+"docs-assets/img/dynamo_resource_0.a0220622.png"},673:function(t,s,a){t.exports=a.p+"docs-assets/img/dynamo_action_3.c4738a41.png"},674:function(t,s,a){t.exports=a.p+"docs-assets/img/dynamo_rule_overview_0.d636a539.png"},675:function(t,s,a){t.exports=a.p+"docs-assets/img/dynamo_result.a4cc1117.png"},676:function(t,s,a){t.exports=a.p+"docs-assets/img/dynamo_rule_overview_1.efab38b4.png"}}]);