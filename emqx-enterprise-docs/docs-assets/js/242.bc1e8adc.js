(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{1507:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"shared-subscription"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shared-subscription"}},[s._v("#")]),s._v(" Shared subscription")]),s._v(" "),a("p",[s._v("Shared subscription is a subscription method that achieves load balancing among multiple subscribers:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("                                                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("subscriber1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" got msg1\n             msg1, msg2, msg3                    /\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("publisher"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  ----------------"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$share")]),s._v('/g/topic"')]),s._v("  -- "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("subscriber2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" got msg2\n                                                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                                                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("subscriber3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" got msg3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("In the above picture, three subscribers subscribe to the same topic "),a("code",[s._v("$share/g/topic")]),s._v(" using a shared subscription method, where "),a("code",[s._v("topic")]),s._v(" is the real topic name they subscribed to, and "),a("code",[s._v("$share/g/")]),s._v("  is a shared subscription Prefix. EMQX Broker supports shared subscription prefixes in two formats:")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("Example")]),s._v(" "),a("th",[s._v("Prefix")]),s._v(" "),a("th",[s._v("Real topic name")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("$queue/t/1")]),s._v(" "),a("td",[s._v("$queue/")]),s._v(" "),a("td",[s._v("t/1")])]),s._v(" "),a("tr",[a("td",[s._v("$share/abc/t/1")]),s._v(" "),a("td",[s._v("$share/abc")]),s._v(" "),a("td",[s._v("t/1")])])])]),s._v(" "),a("h3",{attrs:{id:"shared-subscription-with-groups"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shared-subscription-with-groups"}},[s._v("#")]),s._v(" Shared subscription with groups")]),s._v(" "),a("p",[s._v("Shared subscriptions prefixed with "),a("code",[s._v("$ share/<group-name>")]),s._v(" are shared subscriptions with groups:")]),s._v(" "),a("p",[s._v("group-name can be any string. Subscribers who belong to the same group will receive messages with load balancing, but EMQX Broker will broadcast messages to different groups.")]),s._v(" "),a("p",[s._v("For example, suppose that subscribers s1, s2, and s3 belong to group g1, and subscribers s4 and s5 belong to group g2. Then when EMQX Broker publishes a message msg1 to this topic:")]),s._v(" "),a("ul",[a("li",[s._v("EMQX Broker will send msg1 to both groups g1 and g2")]),s._v(" "),a("li",[s._v("Only one of s1, s2, s3 will receive msg1")]),s._v(" "),a("li",[s._v("Only one of s4 and s5 will receive msg1")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("s1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n           msg1                      /\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emqx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  ------"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$share")]),s._v('/g1/topic"')]),s._v("    - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("s2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" got msg1\n         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("s3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" msg1\n          ----"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$share")]),s._v('/g2/topic"')]),s._v("   --  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("s4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("s5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" got msg1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"shared-subscription-without-group"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shared-subscription-without-group"}},[s._v("#")]),s._v(" Shared subscription without group")]),s._v(" "),a("p",[s._v("Shared subscriptions prefixed with "),a("code",[s._v("$queue/")]),s._v(" are shared subscriptions without groups. It is a special case of "),a("code",[s._v("$share")]),s._v(" subscription, which is quite similar to all subscribers in a subscription group:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("s1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" got msg1\n        msg1,msg2,msg3               /\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emqx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  ---------------"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$queue")]),s._v('/topic"')]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("s2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" got msg2\n                                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("s3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" got msg3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"balancing-strategy-and-distribution-of-ack-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#balancing-strategy-and-distribution-of-ack-configuration"}},[s._v("#")]),s._v(" Balancing strategy and distribution of Ack configuration")]),s._v(" "),a("p",[s._v("EMQX Broker's shared subscription supports balancing strategy and distribution of Ack configuration:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etc/emqx.conf")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# balancing strategy")]),s._v("\nbroker.shared_subscription_strategy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" random\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Per-group balancing strategy")]),s._v("\nbroker."),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$group_name")]),s._v(".shared_subscription_strategy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Applicable to QoS1 QoS2 messages, when enabled, message will be distributed to another group when one group is offline")]),s._v("\nbroker.shared_dispatch_ack_enabled "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[s._v("Balancing strategy")]),s._v(" "),a("th",{staticStyle:{"text-align":"left"}},[s._v("Description")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("random")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("Select randomly among all subscribers")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("round_robin")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("According to the order of subscription")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("sticky")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("Always sent to the last selected subscriber")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("hash")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("According to the hash value of the publisher ClientID")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[s._v("local")]),s._v(" "),a("td",{staticStyle:{"text-align":"left"}},[s._v("Selects random subscriber connected to the node which received the message. If no such subscribers present, selects a random cluster-wise")])])])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("Whether it is a single client subscription or a shared subscription, pay attention to the client performance and message reception rate, otherwise it will cause errors such as message accumulation and client crash.")])])])}),[],!1,null,null,null);t.default=n.exports}}]);