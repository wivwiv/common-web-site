(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{1620:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"bridge-data-to-rabbitmq"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#bridge-data-to-rabbitmq"}},[t._v("#")]),t._v(" Bridge data to RabbitMQ")]),t._v(" "),n("p",[t._v("Setup a RabbitMQ, taking Mac OSX for instance:")]),t._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ brew "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" rabbitmq\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# start rabbitmq")]),t._v("\n$ rabbitmq-server\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("Create a rule:")]),t._v(" "),n("p",[t._v("Go to "),n("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[t._v("EMQX Dashboard"),n("OutboundLink")],1),t._v(', select the\n"rule" tab on the menu to the left.')]),t._v(" "),n("p",[t._v('Select "message.publish", then type in the following SQL:')]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message.publish"')]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[n("img",{attrs:{src:a(393),alt:"image"}})]),t._v(" "),n("p",[t._v("Bind an action:")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('Click on the "+ Add" button under "Action Handler", and then select\n"Data bridge to RabbitMQ" in the pop-up dialog window.\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:a(789),alt:"image"}})]),t._v(" "),n("p",[t._v("Fill in the parameters required by the action:")]),t._v(" "),n("p",[t._v('Two parameters is required by action "Data bridge to RabbitMQ":')]),t._v(" "),n("p",[t._v('1). RabbitMQ Exchange. Here set it to "messages"')]),t._v(" "),n("p",[t._v('2). RabbitMQ Exchange Type. Here set it to "topic"')]),t._v(" "),n("p",[t._v('3). RabbitMQ Routing Key. Here set it to "test"')]),t._v(" "),n("p",[n("img",{attrs:{src:a(790),alt:"image"}})]),t._v(" "),n("p",[t._v('4). Bind a resource to the action. Since the dropdown list "Resource"\nis empty for now, we create a new resource by clicking on the "New\nResource" to the top right, and then select "RabbitMQ":')]),t._v(" "),n("p",[n("img",{attrs:{src:a(791),alt:"image"}})]),t._v(" "),n("p",[t._v("Configure the resource:")]),t._v(" "),n("p",[t._v('Set "RabbitMQ Server" to "127.0.0.1:5672", and keep all other configs\nas default, and click on the "Testing Connection" button to make sure\nthe connection can be created successfully, and then click on the\n"Create" button.')]),t._v(" "),n("p",[n("img",{attrs:{src:a(792),alt:"image"}})]),t._v(" "),n("p",[t._v('Back to the "Actions" dialog, and then click on the "Confirm"\nbutton.')]),t._v(" "),n("p",[n("img",{attrs:{src:a(793),alt:"image"}})]),t._v(" "),n("p",[t._v('Back to the creating rule page, then click on "Create" button. The\nrule we created will be show in the rule list:')]),t._v(" "),n("p",[n("img",{attrs:{src:a(794),alt:"image"}})]),t._v(" "),n("p",[t._v("We have finished, testing the rule by sending an MQTT message to\nemqx:")]),t._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("Topic: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"t/1"')]),t._v("\n\nQoS: "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\nRetained: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\nPayload: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, World\\!"')]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("Write an AMQP Client to consume the messages, following is the one\nwritten in python:")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/usr/bin/env python")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pika\n\nconnection "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pika"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BlockingConnection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    pika"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ConnectionParameters"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nchannel "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" connection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("channel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nchannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exchange_declare"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'messages'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exchange_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'topic'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nresult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" channel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queue_declare"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queue"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exclusive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nqueue_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queue\n\nchannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("queue_bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'messages'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" queue"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("queue_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" routing_key"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[*] Waiting for messages. To exit press CTRL+C'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" properties"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('" [x] %r"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nchannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("basic_consume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    queue"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("queue_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" on_message_callback"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" auto_ack"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nchannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("start_consuming"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br")])]),n("p",[n("img",{attrs:{src:a(795),alt:"image"}})]),t._v(" "),n("p",[t._v('And from the rule list, verify that the "Matched" column has increased\nto 1:')]),t._v(" "),n("p",[n("img",{attrs:{src:a(796),alt:"image"}})])])}),[],!1,null,null,null);s.default=e.exports},393:function(t,s,a){t.exports=a.p+"docs-assets/img/mysql_sql_1.515176ea.png"},789:function(t,s,a){t.exports=a.p+"docs-assets/img/rabbit_action_0.1d624e47.png"},790:function(t,s,a){t.exports=a.p+"docs-assets/img/rabbit_action_1.1b3f633f.png"},791:function(t,s,a){t.exports=a.p+"docs-assets/img/rabbit_action_2.6f19d279.png"},792:function(t,s,a){t.exports=a.p+"docs-assets/img/rabbit_resource_0.6987d088.png"},793:function(t,s,a){t.exports=a.p+"docs-assets/img/rabbit_action_3.ddda0b4c.png"},794:function(t,s,a){t.exports=a.p+"docs-assets/img/rabbit_rule_overview_0.facae3f8.png"},795:function(t,s,a){t.exports=a.p+"docs-assets/img/rabbit_result.a8f0793f.png"},796:function(t,s,a){t.exports=a.p+"docs-assets/img/rabbit_rule_overview_1.65d95bb4.png"}}]);