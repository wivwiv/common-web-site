(window.webpackJsonp=window.webpackJsonp||[]).push([[331],{1686:function(e,s,a){"use strict";a.r(s);var n=a(10),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"在运行时安装-emqx-补丁包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在运行时安装-emqx-补丁包"}},[e._v("#")]),e._v(" 在运行时安装 EMQX 补丁包")]),e._v(" "),a("p",[e._v("如果一个 Bug 修复只更新了少数几个 module，在已经知道需要更新的 module 列表的情况下，可以使用补丁包方式升级 EMQX。")]),e._v(" "),a("p",[e._v("注意：如果可以使用版本热升级的方式，则首选版本热升级。只有版本热升级不可用，并且你了解在生产环境中\n安装补丁包的后果的情况下，才可以使用此方式解决问题。")]),e._v(" "),a("h2",{attrs:{id:"安装-emqx-补丁包的步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-emqx-补丁包的步骤"}},[e._v("#")]),e._v(" 安装 EMQX 补丁包的步骤")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("从 EMQX 开发者那里获取本次需要更新的 modules 列表。比如：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("emqx.beam\nemqx_rule_engine.beam\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("从 EMQX 官网，或者 EMQX 开发者那里获取本次更新对应的软件包。")])])]),e._v(" "),a("p",[e._v("访问 "),a("a",{attrs:{href:"https://www.emqx.com/en/try?product=broker",target:"_blank",rel:"noopener noreferrer"}},[e._v("开源版下载地址"),a("OutboundLink")],1),e._v(" 或者 "),a("a",{attrs:{href:"https://www.emqx.com/en/try?product=enterprise",target:"_blank",rel:"noopener noreferrer"}},[e._v("企业版下载地址"),a("OutboundLink")],1),e._v("，下载对应版本的 zip 软件包。")]),e._v(" "),a("p",[e._v("注意选择正确的软件版本号、OTP 版本号、以及操作系统类型，并且选择 "),a("strong",[e._v('"zip"')]),e._v(" 包类型。")]),e._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[e._v("解压下载的 zip 包，并找到要更新的 modules：")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("unzip")]),e._v(" -q emqx-ee-4.4.1-otp24.1.5-3-ubuntu20.04-amd64.zip\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("假设我们要更新 emqx.beam 和 emqx_rule_engine.beam，则在解压目录下寻找他们：")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),e._v(" ./emqx -name "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"emqx.beam"')]),e._v("\n./emqx/lib/emqx-4.4.1/ebin/emqx.beam\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),e._v(" ./emqx -name "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"emqx_rule_engine.beam"')]),e._v("\n./emqx/lib/emqx_rule_engine-4.4.1/ebin/emqx_rule_engine.beam\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("确保 EMQX 是已经启动的状态：")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ emqx_ctl status\nNode "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'emqx@127.0.0.1'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.4")]),e._v(".1 is started\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("找到 beam 文件的对应位置，备份并替换原 beam 文件:")]),e._v(" "),a("p",[e._v("找到 EMQX 的安装目录：")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ emqx root_dir\n"),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/usr/lib/emqx"')]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("在安装目录下的 lib 目录下查找原 beam 文件的路径:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),e._v(" /usr/lib/emqx/lib -name "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"emqx.beam"')]),e._v("\n/usr/lib/emqx/lib/emqx-4.4.0/ebin/emqx.beam\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),e._v(" /usr/lib/emqx/lib -name "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"emqx_rule_engine.beam"')]),e._v("\n/usr/lib/emqx/lib/emqx_rule_engine-4.4.0/ebin/emqx_rule_engine.beam\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("备份原 beam 文件到 "),a("code",[e._v("/tmp")]),e._v(" 目录:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" /usr/lib/emqx/lib/emqx-4.4.0/ebin/emqx.beam "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n    /usr/lib/emqx/lib/emqx_rule_engine-4.4.0/ebin/emqx_rule_engine.beam /tmp\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("使用新 beam 文件覆盖到对应位置:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" -f ./emqx/lib/emqx-4.4.1/ebin/emqx.beam /usr/lib/emqx/lib/emqx-4.4.0/ebin/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" -f ./emqx/lib/emqx_rule_engine-4.4.1/ebin/emqx_rule_engine.beam /usr/lib/emqx/lib/emqx_rule_engine-4.4.0/ebin/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("加载新的 beam 文件:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ emqx "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("eval")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'c:lm().'")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("module, emqx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("module, emqx_rule_engine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])])])]),e._v(" "),a("h2",{attrs:{id:"回滚补丁包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回滚补丁包"}},[e._v("#")]),e._v(" 回滚补丁包")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("把安装补丁包时备份好的文件复制回原来的目录：")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" -f /tmp/emqx.beam /usr/lib/emqx/lib/emqx-4.4.0/ebin/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" -f /tmp/emqx_rule_engine.beam /usr/lib/emqx/lib/emqx_rule_engine-4.4.0/ebin/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("重新加载 beam 文件:")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ emqx "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("eval")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'c:lm().'")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("module, emqx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("module, emqx_rule_engine"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])])])])])}),[],!1,null,null,null);s.default=t.exports}}]);