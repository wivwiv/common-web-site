(window.webpackJsonp=window.webpackJsonp||[]).push([[379],{1754:function(e,s,a){"use strict";a.r(s);var t=a(10),n=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"利用-emqx-operator-部署-emqx-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用-emqx-operator-部署-emqx-集群"}},[e._v("#")]),e._v(" 利用 EMQX Operator 部署 EMQX 集群")]),e._v(" "),a("p",[e._v("EMQX Operator 最新信息, 请访问 "),a("a",{attrs:{href:"https://github.com/emqx/emqx-operator/blob/main/docs/zh_CN/getting-started/getting-started.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("github"),a("OutboundLink")],1)]),e._v(" "),a("ol",[a("li",[a("p",[e._v("使用 "),a("a",{attrs:{href:"https://github.com/cert-manager/cert-manager",target:"_blank",rel:"noopener noreferrer"}},[e._v("cert-manager"),a("OutboundLink")],1),e._v(" 给 webhook 服务提供证书，可以参考 "),a("a",{attrs:{href:"https://cert-manager.io/docs/installation/",target:"_blank",rel:"noopener noreferrer"}},[e._v("cert-manager 文档"),a("OutboundLink")],1),e._v(" 安装")])]),e._v(" "),a("li",[a("p",[e._v("可以通过如下两种方式之一来安装 Operator Controller：")]),e._v(" "),a("ul",[a("li",[e._v("使用静态文件安装")])]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -f -L "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"https://github.com/emqx/emqx-operator/releases/download/1.1.10/emqx-operator-controller.yaml"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" kubectl apply -f -\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[e._v("使用 Helm 安装")]),e._v(" "),a("ul",[a("li",[e._v("添加 EMQX Helm 仓库")])]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("helm repo "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" emqx https://repos.emqx.io/charts \nhelm repo update\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("ul",[a("li",[e._v("用 Helm 安装 EMQX Operator 控制器")])]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("$ helm "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" emqx-operator emqx/emqx-operator "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v(" \n  --set "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("installCRDs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v(" \n  --namespace emqx-operator-system "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v(" \n  --create-namespace\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])])])])]),e._v(" "),a("li",[a("p",[e._v("检查 EMQX Operator 控制器状态")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("$ kubectl get pods -l "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"control-plane=controller-manager"')]),e._v(" -n emqx-operator-system \nNAME READY STATUS RESTARTS AGE \nemqx-operator-controller-manager-68b866c8bf-kd4g6 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1 Running "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" 15s\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])])])]),e._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[e._v("部署 EMQX Enterprise")])]),e._v(" "),a("ul",[a("li",[a("p",[e._v("部署 EMQX Custom Resource")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"EOF"'),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" kubectl apply -f -")]),e._v("\napiVersion: apps.emqx.io/v1beta2\nkind: EmqxEnterprise\nmetadata:\n  name: emqx-ee\nspec:\n  image: emqx/emqx-ee:4.3.6\nEOF")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("检查 EMQX 状态")]),e._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("$ kubectl get pods \nNAME READY STATUS RESTARTS AGE \nemqx-ee-0 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1 Running "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" 22s \nemqx-ee-1 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1 Running "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" 22s \nemqx-ee-2 "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("/1 Running "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" 22s\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it emqx-ee-0 -- emqx_ctl status \nNode "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'emqx-ee@emqx-ee-0.emqx-ee-headless.default.svc.cluster.local'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4.3")]),e._v(".6 is started\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it emqx-ee-0 -- emqx_ctl cluster status \nCluster status: "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#{running_nodes =>")]),e._v("\n                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'emqx-ee@emqx-ee-0.emqx-ee-headless.default.svc.cluster.local'")]),e._v(",\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'emqx-ee@emqx-ee-1.emqx-ee-headless.default.svc.cluster.local'")]),e._v(",\n                    "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'emqx-ee@emqx-ee-2.emqx-ee-headless.default.svc.cluster.local'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(",\n               stopped_nodes "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);