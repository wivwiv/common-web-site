(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{1124:function(e,t,_){e.exports=_.p+"docs-assets/img/mod_subscriptions_1.7346c0ab.png"},1125:function(e,t,_){e.exports=_.p+"docs-assets/img/mod_subscriptions_2.23c4ddea.png"},1126:function(e,t,_){e.exports=_.p+"docs-assets/img/mod_subscriptions_3.b1ea1705.png"},1789:function(e,t,_){"use strict";_.r(t);var v=_(10),s=Object(v.a)({},(function(){var e=this,t=e.$createElement,v=e._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"mqtt-代理订阅"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-代理订阅"}},[e._v("#")]),e._v(" MQTT 代理订阅")]),e._v(" "),v("p",[e._v("EMQX 的代理订阅功能使得客户端在连接建立时，不需要发送额外的 SUBSCRIBE 报文，便能自动建立用户预设的订阅关系。")]),e._v(" "),v("h2",{attrs:{id:"创建模块"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#创建模块"}},[e._v("#")]),e._v(" 创建模块")]),e._v(" "),v("p",[e._v("打开 "),v("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("EMQX Dashboard"),v("OutboundLink")],1),e._v("，点击左侧的 “模块” 选项卡，选择添加：")]),e._v(" "),v("p",[v("img",{attrs:{src:_(390),alt:"image-20200927213049265"}})]),e._v(" "),v("p",[e._v("选择 MQTT 代理订阅模块")]),e._v(" "),v("p",[v("img",{attrs:{src:_(1124),alt:"image-20200927213049265"}})]),e._v(" "),v("p",[e._v("配置相关参数")]),e._v(" "),v("p",[v("img",{attrs:{src:_(1125),alt:"image-20200927213049265"}})]),e._v(" "),v("p",[e._v("点击添加后，模块添加完成")]),e._v(" "),v("p",[v("img",{attrs:{src:_(1126),alt:"image-20200927213049265"}})]),e._v(" "),v("h2",{attrs:{id:"订阅选项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#订阅选项"}},[e._v("#")]),e._v(" 订阅选项")]),e._v(" "),v("ul",[v("li",[v("p",[e._v("服务质量（ QoS ）")]),e._v(" "),v("p",[e._v("服务端可以向客户端发送的应用消息的最大 QoS 等级。")])]),e._v(" "),v("li",[v("p",[e._v("NL（ No Local ）")]),e._v(" "),v("p",[e._v("应用消息是否能够被转发到发布此消息的客户端。")]),e._v(" "),v("ul",[v("li",[v("p",[e._v("NL 值为 0 时，表示应用消息可以被转发给发布此消息的客户端。")])]),e._v(" "),v("li",[v("p",[e._v("NL 值为 1 时，表示应用消息不能被转发给发布此消息的客户端。")])])])]),e._v(" "),v("li",[v("p",[e._v("RAP（ Retain As Published ）")]),e._v(" "),v("p",[e._v("向此订阅转发应用消息时，是否保持消息被发布时设置的保留(RETAIN)标志。")]),e._v(" "),v("ul",[v("li",[v("p",[e._v("RAP 值为 0 时，表示向此订阅转发应用消息时把保留标志设置为 0。")])]),e._v(" "),v("li",[v("p",[e._v("RAP 值为 1 时，表示向此订阅转发应用消息时保持消息被发布时设置的保留标志。")])])])]),e._v(" "),v("li",[v("p",[e._v("RH（ Retain Handling ）")]),e._v(" "),v("p",[e._v("当订阅建立时，是否发送保留消息")]),e._v(" "),v("ul",[v("li",[v("p",[e._v("0：订阅建立时发送保留消息")])]),e._v(" "),v("li",[v("p",[e._v("1：订阅建立时，若该订阅当前不存在则发送保留消息")])]),e._v(" "),v("li",[v("p",[e._v("2：订阅建立时不要发送保留消息")])])])])]),e._v(" "),v("h2",{attrs:{id:"代理订阅规则"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#代理订阅规则"}},[e._v("#")]),e._v(" 代理订阅规则")]),e._v(" "),v("p",[e._v("在配置代理订阅的主题时，EMQX 提供了 "),v("code",[e._v("%c")]),e._v(" 和 "),v("code",[e._v("%u")]),e._v(" 两个占位符供用户使用，EMQX 会在执行代理订阅时将配置中的 "),v("code",[e._v("%c")]),e._v(" 和 "),v("code",[e._v("%u")]),e._v(" 分别替换为客户端的 "),v("code",[e._v("Client ID")]),e._v(" 和 "),v("code",[e._v("Username")]),e._v("，需要注意的是，"),v("code",[e._v("%c")]),e._v(" 和 "),v("code",[e._v("%u")]),e._v(" 必须占用一整个主题层级。")]),e._v(" "),v("p",[e._v("例如，添加上文图中的规则后：配置 A、B 两个客户端，客户端 A 的 "),v("code",[e._v("Client ID")]),e._v(" 为 "),v("code",[e._v("testclientA")]),e._v("，"),v("code",[e._v("Username")]),e._v(" 为 "),v("code",[e._v("testerA")]),e._v("，客户端 B 的 "),v("code",[e._v("Client ID")]),e._v(" 为 "),v("code",[e._v("testclientB")]),e._v("，"),v("code",[e._v("Username")]),e._v(" 为 "),v("code",[e._v("testerB")]),e._v("。")]),e._v(" "),v("p",[e._v("A 客户端使用 MQTT V3.1.1 协议连接 EMQX，根据上文的配置规则，代理订阅功能会主动帮客户端订阅 QoS 为 1 的 "),v("code",[e._v("client/testclientA")]),e._v(" 和 QoS 为 2 的 "),v("code",[e._v("user/testerA")]),e._v(" 这两个主题，因为连接协议为 MQTT V3.1.1，所以配置中的 No Local、Retain As Published、Retain Handling 不生效。")]),e._v(" "),v("p",[e._v("B 客户端使用 MQTT V5 协议连接 EMQX，根据上文的配置规则，代理订阅功能会主动帮客户端订阅 "),v("code",[e._v("client/testclientB")]),e._v(" 和 "),v("code",[e._v("user/testerB")]),e._v(" 这两个主题，其中 "),v("code",[e._v("client/testclientB")]),e._v(" 的订阅选项为 Qos = 1，No Local、Retain As Published、Retain Handling 均为 0；"),v("code",[e._v("user/testerB")]),e._v(" 的订阅选项为 Qos = 2、No Local = 1、Retain As Published = 1 、Retain Handling = 1。")])])}),[],!1,null,null,null);t.default=s.exports},390:function(e,t,_){e.exports=_.p+"docs-assets/img/modules.89e07c9c.png"}}]);