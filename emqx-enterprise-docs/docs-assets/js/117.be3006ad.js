(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{1578:function(e,t,s){"use strict";s.r(t);var a=s(10),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"http-authentication-acl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-authentication-acl"}},[e._v("#")]),e._v(" HTTP Authentication/ACL")]),e._v(" "),a("p",[e._v("HTTP Authentication/ACL uses an external self-built HTTP application authentication data source, and judges the authentication result based on the data returned by the HTTP API, which can implement complex authentication logic and complex ACL verification logic.")]),e._v(" "),a("h2",{attrs:{id:"create-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-module"}},[e._v("#")]),e._v(" Create module")]),e._v(" "),a("p",[e._v("Open "),a("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[e._v("EMQX Dashboard"),a("OutboundLink")],1),e._v(', click the "Modules" tab on the left, and choose to add:')]),e._v(" "),a("p",[a("img",{attrs:{src:s(391),alt:"image-20200927213049265"}})]),e._v(" "),a("p",[e._v("Select HTTP Authentication/ACL module")]),e._v(" "),a("p",[a("img",{attrs:{src:s(585),alt:"image-20200927213049265"}})]),e._v(" "),a("p",[e._v("Configure related parameters")]),e._v(" "),a("p",[a("img",{attrs:{src:s(586),alt:"image-20200927213049265"}})]),e._v(" "),a("p",[e._v("After clicking add, the module is added")]),e._v(" "),a("p",[a("img",{attrs:{src:s(587),alt:"image-20200927213049265"}})]),e._v(" "),a("h2",{attrs:{id:"http-authentication-principle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-authentication-principle"}},[e._v("#")]),e._v(" HTTP authentication principle")]),e._v(" "),a("p",[e._v("EMQX uses the relevant information of the current client as parameters in the device connection event, initiates a request for query permissions to the user-defined authentication service, and processes the authentication request through the returned HTTP "),a("strong",[e._v("response status code")]),e._v(" (HTTP statusCode).")]),e._v(" "),a("p",[e._v("-Authentication failed: The API returns status codes other than 200\n-Successful authentication: API returns 200 status code\n-Ignore authentication: API returns 200 status code and response body is "),a("code",[e._v("ignore")])]),e._v(" "),a("h2",{attrs:{id:"authentication-request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#authentication-request"}},[e._v("#")]),e._v(" Authentication request")]),e._v(" "),a("p",[e._v("When performing identity authentication, EMQX will use the current client information to fill in and initiate the authentication query request configured by the user, and query the authentication data of the client on the HTTP server.")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Authentication request address")]),e._v("\nhttp://127.0.0.1:8991/mqtt/auth\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## HTTP request method")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Value: POST | GET")]),e._v("\nPOST\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Request parameters")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("clientid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%c,username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%u,password"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%P\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("p",[e._v("When the HTTP request method is GET, the request parameters will be passed in the form of URL query string; POST request will submit the request parameters in the form of ordinary form (content-type is x-www-form-urlencoded).")]),e._v(" "),a("p",[e._v("You can use the following placeholders in the authentication request. EMQX will automatically fill in the client information when requesting:")]),e._v(" "),a("p",[e._v("-%u: username\n-%c: Client ID\n-%a: Client IP address\n-%r: Client access protocol\n-%P: Plain text password\n-%p: client port\n-%C: TLS certificate common name (domain name or subdomain name of the certificate), valid only when TLS connection\n-%d: TLS certificate subject, only valid when TLS connection")]),e._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[e._v("DANGER")]),e._v(" "),a("p",[e._v("It is recommended to use the POST and PUT methods. When using the GET method, the plaintext password may be recorded in the server log during the transmission along with the URL.")])]),e._v(" "),a("h2",{attrs:{id:"http-access-control-principle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-access-control-principle"}},[e._v("#")]),e._v(" HTTP access control principle")]),e._v(" "),a("p",[e._v("EMQX uses current client-related information as parameters in device publishing and subscription events to initiate a request for permissions to a user-defined authentication service, and process ACL authorization requests through the returned HTTP "),a("strong",[e._v("response status code")]),e._v(" (HTTP statusCode).")]),e._v(" "),a("p",[e._v("-No permission: The API returns status codes other than 200\n-Authorization is successful: API returns 200 status code\n-Ignore authorization: API returns 200 status code and response body is "),a("code",[e._v("ignore")])]),e._v(" "),a("h2",{attrs:{id:"http-request-information"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-request-information"}},[e._v("#")]),e._v(" HTTP request information")]),e._v(" "),a("p",[e._v("HTTP API basic request information, configuration certificate, request header and retry rules.")]),e._v(" "),a("p",[e._v("When publishing and subscribing authentication, EMQX will use the current client information to fill in and initiate the ACL authorization query request configured by the user, and query the authorization data of the client on the HTTP server.")]),e._v(" "),a("h2",{attrs:{id:"superuser-request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#superuser-request"}},[e._v("#")]),e._v(" superuser request")]),e._v(" "),a("p",[e._v("First check whether the client is a super user. If the client is a super user, the ACL query will be skipped.")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# etc/plugins/emqx_auth_http.conf")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Super user request address")]),e._v("\nhttp://127.0.0.1:8991/mqtt/superuser\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## HTTP request method")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Value: POST | GET")]),e._v("\nPOST\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Super User Request Parameters")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("clientid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%c,username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%u\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("h2",{attrs:{id:"acl-access-control-request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acl-access-control-request"}},[e._v("#")]),e._v(" ACL Access Control Request")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Access control request address")]),e._v("\nhttp://127.0.0.1:8991/mqtt/acl\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## HTTP request method")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Value: POST | GET")]),e._v("\nPOST\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("## Access control request parameters")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("access")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%A,username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%u,clientid"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%c,ipaddr"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%a,topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%t,mountpoint"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("%m\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("h2",{attrs:{id:"request-description"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#request-description"}},[e._v("#")]),e._v(" Request description")]),e._v(" "),a("p",[e._v("When the HTTP request method is GET, the request parameters will be passed in the form of a URL query string; POST and PUT requests will submit the request parameters in the form of ordinary forms (content-type is x-www-form-urlencoded).")]),e._v(" "),a("p",[e._v("You can use the following placeholders in the authentication request. EMQX will automatically fill in the client information when requesting:")]),e._v(" "),a("p",[e._v("-%A: Operation type, '1' subscription; '2' release\n-%u: client user name\n-%c: Client ID\n-%a: Client IP address\n-%r: Client access protocol\n-%m: Mountpoint\n-%t: Subject")]),e._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[e._v("DANGER")]),e._v(" "),a("p",[e._v("It is recommended to use the POST and PUT methods. When using the GET method, the plaintext password may be recorded in the server log during the transmission along with the URL.")])])])}),[],!1,null,null,null);t.default=n.exports},391:function(e,t,s){e.exports=s.p+"docs-assets/img/modules.1814040c.png"},585:function(e,t,s){e.exports=s.p+"docs-assets/img/auth_http2.e203e48c.png"},586:function(e,t,s){e.exports=s.p+"docs-assets/img/auth_http3.ff2ff0cb.png"},587:function(e,t,s){e.exports=s.p+"docs-assets/img/auth_http4.ef2805c5.png"}}]);