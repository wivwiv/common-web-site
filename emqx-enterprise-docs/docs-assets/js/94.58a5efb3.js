(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{1615:function(e,a,s){"use strict";s.r(a);var t=s(10),n=Object(t.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"bridge-data-to-kafka"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bridge-data-to-kafka"}},[e._v("#")]),e._v(" Bridge data to Kafka")]),e._v(" "),t("p",[e._v("Setup a Kafka, taking Mac OSX for instance:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" https://archive.apache.org/dist/kafka/2.8.0/kafka_2.13-2.8.0.tgz\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -xzf  kafka_2.13-2.8.0.tgz\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" kafka_2.13-2.8.0\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# start Zookeeper")]),e._v("\n./bin/zookeeper-server-start.sh config/zookeeper.properties\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# start Kafka")]),e._v("\n./bin/kafka-server-start.sh config/server.properties\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br")])]),t("p",[e._v("Create topics for\nKafka:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ ./bin/kafka-topics.sh --zookeeper localhost:2181 --replication-factor "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" --partitions "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" --topic testTopic --create\n\nCreated topic testTopic.\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(" note:: Kafka topics should be created before creating the kafka rule, or the rule creation would not success.\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("Create a rule:")]),e._v(" "),t("p",[e._v("Go to "),t("a",{attrs:{href:"http://127.0.0.1:18083/#/rules",target:"_blank",rel:"noopener noreferrer"}},[e._v("EMQX Dashboard"),t("OutboundLink")],1),e._v(', select the\n"rule" tab on the menu to the left.')]),e._v(" "),t("p",[e._v('Select "message.publish", then type in the following SQL:')]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("SELECT\n    *\nFROM\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"message.publish"')]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p",[t("img",{attrs:{src:s(393),alt:"image"}})]),e._v(" "),t("p",[e._v("Bind an action:")]),e._v(" "),t("p",[e._v('Click on the "+ Add" button under "Action Handler", and then select\n"Data bridge to Kafka" in the pop-up dialog window.')]),e._v(" "),t("p",[t("img",{attrs:{src:s(763),alt:"image"}})]),e._v(" "),t("p",[e._v("Fill in the parameters required by the action:")]),e._v(" "),t("p",[e._v('Two parameters is required by action "Data to Kafka":')]),e._v(" "),t("p",[e._v("1). Kafka Topic")]),e._v(" "),t("p",[e._v('2). Bind a resource to the action. Since the dropdown list "Resource"\nis empty for now, we create a new resource by clicking on the "New\nResource" to the top right, and then select "Kafka":')]),e._v(" "),t("p",[t("img",{attrs:{src:s(764),alt:"image"}})]),e._v(" "),t("p",[e._v("Configure the resource:")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('Set the "Kafka Server" to "127.0.0.1:9092" (multiple servers should\nbe separated by comma), and keep all other configs as default, and\nclick on the "Testing Connection" button to make sure the connection\ncan be created successfully, and then click on the "Create" button.\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("p",[t("img",{attrs:{src:s(765),alt:"image"}})]),e._v(" "),t("p",[e._v('Back to the "Actions" dialog, and then click on the "Confirm"\nbutton.')]),e._v(" "),t("p",[t("img",{attrs:{src:s(766),alt:"image"}})]),e._v(" "),t("p",[e._v('Back to the creating rule page, then click on "Create" button. The\nrule we created will be show in the rule list:')]),e._v(" "),t("p",[t("img",{attrs:{src:s(446),alt:"image"}})]),e._v(" "),t("p",[e._v("We have finished, testing the rule by sending an MQTT message to\nemqx:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("Topic: "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"t/1"')]),e._v("\n\nQoS: "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n\nRetained: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n\nPayload: "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hello"')]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("p",[e._v("Then inspect Kafka by consume from the\ntopic:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("$ ./bin/kafka-console-consumer.sh --bootstrap-server "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("127.0")]),e._v(".0.1:9092  --topic testTopic --from-beginning\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v('And from the rule list, verify that the "Matched" column has increased\nto 1:')]),e._v(" "),t("p",[t("img",{attrs:{src:s(446),alt:"image"}})])])}),[],!1,null,null,null);a.default=n.exports},393:function(e,a,s){e.exports=s.p+"docs-assets/img/mysql_sql_1.515176ea.png"},446:function(e,a,s){e.exports=s.p+"docs-assets/img/kafka_rule_overview_0.1fcf68c2.png"},763:function(e,a,s){e.exports=s.p+"docs-assets/img/kafka_action_0.3965f6fe.png"},764:function(e,a,s){e.exports=s.p+"docs-assets/img/kafka_action_1.1d6e929c.png"},765:function(e,a,s){e.exports=s.p+"docs-assets/img/kafka_resource_0.d1c87f54.png"},766:function(e,a,s){e.exports=s.p+"docs-assets/img/kafka_action_2.2c925054.png"}}]);