(window.webpackJsonp=window.webpackJsonp||[]).push([[321],{1671:function(s,a,e){"use strict";e.r(a);var t=e(10),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"redis-认证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-认证"}},[s._v("#")]),s._v(" Redis 认证")]),s._v(" "),e("p",[s._v("Redis 认证使用外部 Redis 数据库作为认证数据源，可以存储大量数据，同时方便与外部设备管理系统集成。")]),s._v(" "),e("p",[s._v("插件：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("emqx_auth_redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("emqx_auth_redis 插件同时包含 ACL 功能，可通过注释禁用。")])]),s._v(" "),e("p",[s._v("要启用 Redis 认证，需要在 "),e("code",[s._v("etc/plugins/emqx_auth_redis.conf")]),s._v(" 中配置以下内容：")]),s._v(" "),e("h2",{attrs:{id:"redis-连接信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis-连接信息"}},[s._v("#")]),s._v(" Redis 连接信息")]),s._v(" "),e("p",[s._v("Redis 基础连接信息，需要保证集群内所有节点均能访问。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etc/plugins/emqx_auth_redis.conf")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 服务器地址")]),s._v("\nauth.redis.server "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 连接池大小")]),s._v("\nauth.redis.pool "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\nauth.redis.database "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nauth.redis.password "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h2",{attrs:{id:"默认数据结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#默认数据结构"}},[s._v("#")]),s._v(" 默认数据结构")]),s._v(" "),e("p",[s._v("Redis 认证默认配置下使用哈希表存储认证数据，使用 "),e("code",[s._v("mqtt_user:")]),s._v(" 作为 Redis 键前缀，数据结构如下：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("redis"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" hgetall mqtt_user:emqx\n  password public\n  salt wivwiv\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("默认配置下示例数据如下：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("HMSET mqtt_user:emqx\n  password public\n  salt wivwiv\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("启用 Redis 认证后，你可以通过用户名： emqx，密码：public 连接。")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("这是默认配置使用的数据结构，熟悉该插件的使用后你可以使用任何满足条件的数据结构进行认证。")])]),s._v(" "),e("h2",{attrs:{id:"加盐规则与哈希方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#加盐规则与哈希方法"}},[s._v("#")]),s._v(" 加盐规则与哈希方法")]),s._v(" "),e("p",[s._v("Redis 认证支持配置"),e("RouterLink",{attrs:{to:"/zh/enterprise/latest/advanced/auth.html#加盐规则与哈希方法"}},[s._v("加盐规则与哈希方法")]),s._v("，默认存储明文密码不做处理：")],1),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etc/plugins/emqx_auth_redis.conf")]),s._v("\n\nauth.redis.password_hash "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" plain\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"认证查询命令-auth-query-cmd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#认证查询命令-auth-query-cmd"}},[s._v("#")]),s._v(" 认证查询命令（auth query cmd）")]),s._v(" "),e("p",[s._v("进行身份认证时，EMQX 将使用当前客户端信息填充并执行用户配置的认证查询命令，查询出该客户端在 Redis 中的认证数据。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# etc/plugins/emqx_auth_redis.conf")]),s._v("\n\nauth.redis.auth_cmd "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" HMGET mqtt_user:%u password\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("你可以在命令中使用以下占位符，执行时 EMQX 将自动填充为客户端信息：")]),s._v(" "),e("ul",[e("li",[s._v("%u：用户名")]),s._v(" "),e("li",[s._v("%c：Client ID")]),s._v(" "),e("li",[s._v("%C：TLS 证书公用名（证书的域名或子域名），仅当 TLS 连接时有效")]),s._v(" "),e("li",[s._v("%d：TLS 证书 subject，仅当 TLS 连接时有效")])]),s._v(" "),e("p",[s._v("你可以根据业务需要调整认证查询命令，使用任意 "),e("a",{attrs:{href:"http://redisdoc.com/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Redis 支持的命令"),e("OutboundLink")],1),s._v("，但是任何情况下认证查询命令需要满足以下条件：")]),s._v(" "),e("ol",[e("li",[s._v("查询结果中第一个数据必须为 password，EMQX 使用该字段与客户端密码比对")]),s._v(" "),e("li",[s._v("如果启用了加盐配置，查询结果中第二个数据必须是 salt 字段，EMQX 使用该字段作为 salt（盐）值")])])])}),[],!1,null,null,null);a.default=r.exports}}]);