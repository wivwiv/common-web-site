(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{1573:function(t,s,e){"use strict";e.r(s);var a=e(10),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jt-t808-protocol-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jt-t808-protocol-gateway"}},[t._v("#")]),t._v(" JT/T808 Protocol Gateway")]),t._v(" "),a("h2",{attrs:{id:"protocol-introduction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#protocol-introduction"}},[t._v("#")]),t._v(" Protocol Introduction")]),t._v(" "),a("p",[a("strong",[t._v("emqx-jt808")]),t._v(" As emqx's access gateway, according to its functional logic and the relationship between the entire system, the entire message exchange process can be divided into three parts: terminal side, platform side and other sides:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("|<-- Terminal --\x3e|<---------- Broker Side ----------\x3e|<---  Others  ---\x3e|\n|<-    Side    ->|                                   |<--    Side    --\x3e|\n\n+---+                                                  PUB  +-----------+\n| D |  INCOMING  +------------+    PUB     +---------+   --\x3e| subscriber|\n| E |-----------\x3e|            |-----------\x3e|         |--/   +-----------+\n| V |            | emqx-jt808 |            |  EMQX  |\n| I |<-----------|            |<-----------|         |<--   +-----------+\n| C |  OUTGOING  +------------+    PUB     +---------+   \\--| publisher |\n| E |                                                  PUB  +-----------+\n+---+\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("ol",[a("li",[t._v("Terminal side: exchange data through the JT/T 808 protocol to report different types of data, or send downlink messages to the terminal.")]),t._v(" "),a("li",[t._v("Platform side: emqx-jt808 decodes the message and performs registration/authentication, or PUBLISH the data message to a specific topic; the agent subscribes to the downstream topic, and converts the downstream PUBLISH message into a JT/T 808 protocol message The text structure is delivered to the terminal.")]),t._v(" "),a("li",[t._v("The other side can subscribe to the topic of the upstream PUBLISH message appearing in 2 to receive the upstream message. Or to publish a message to a specific downlink topic to send data to the terminal side.")])]),t._v(" "),a("h2",{attrs:{id:"create-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-module"}},[t._v("#")]),t._v(" Create module")]),t._v(" "),a("p",[t._v("Open "),a("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("EMQX Dashboard"),a("OutboundLink")],1),t._v(', click the "Modules" tab on the left, and choose to add:')]),t._v(" "),a("p",[a("img",{attrs:{src:e(391),alt:"image-20200927213049265"}})]),t._v(" "),a("p",[t._v("Select JT/T808 protocol to access the gateway:")]),t._v(" "),a("p",[a("img",{attrs:{src:e(561),alt:"image-20200927213049265"}})]),t._v(" "),a("p",[t._v("Configure related basic parameters:")]),t._v(" "),a("p",[a("img",{attrs:{src:e(562),alt:"image-20200927213049265"}})]),t._v(" "),a("p",[t._v("Add listening port:")]),t._v(" "),a("p",[a("img",{attrs:{src:e(563),alt:"image-20200927213049265"}})]),t._v(" "),a("p",[t._v("Configure monitoring parameters:")]),t._v(" "),a("p",[a("img",{attrs:{src:e(564),alt:"image-20200927213049265"}})]),t._v(" "),a("p",[t._v("Click to confirm to the configuration parameter page:")]),t._v(" "),a("p",[a("img",{attrs:{src:e(565),alt:"image-20200927213049265"}})]),t._v(" "),a("p",[t._v("After clicking Add, the module is added:\n"),a("img",{attrs:{src:e(566),alt:"image-20200927213049265"}})]),t._v(" "),a("p",[a("strong",[t._v("emqx-jt808 implementation regulations:")])]),t._v(" "),a("p",[t._v("-In the system, the mobile phone number is used as the unique identification of a connection, namely ClientId")]),t._v(" "),a("h3",{attrs:{id:"configuration-parameters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration-parameters"}},[t._v("#")]),t._v(" Configuration parameters")]),t._v(" "),a("p",[t._v("The implementation of emqx-jt808 supports anonymous access authentication:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Configuration")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Allow anonymous")]),t._v(" "),a("td",[t._v("Whether to allow anonymous user login")])]),t._v(" "),a("tr",[a("td",[t._v("Registray URL")]),t._v(" "),a("td",[t._v("JT/T808 terminal registered HTTP interface address")])]),t._v(" "),a("tr",[a("td",[t._v("Authentication URL")]),t._v(" "),a("td",[t._v("JT/T808 terminal access authentication HTTP interface address")])]),t._v(" "),a("tr",[a("td",[t._v("Downlink Message Topic")]),t._v(" "),a("td",[t._v("Upstream topic. Uplink message to the message topic in the EMQX system%c: ClientId of the connected client, %p: Phone")])]),t._v(" "),a("tr",[a("td",[t._v("Uplink Message Topic")]),t._v(" "),a("td",[t._v("Downstream topic. Uplink message to the message topic in the EMQX system%c: ClientId of the connected client, %p: Phone")])]),t._v(" "),a("tr",[a("td",[t._v("Max Frame Length")]),t._v(" "),a("td",[t._v("Maximum processing size of a single JT/T808 protocol message")])])])]),t._v(" "),a("h3",{attrs:{id:"registration-and-authentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#registration-and-authentication"}},[t._v("#")]),t._v(" Registration and authentication")]),t._v(" "),a("p",[t._v("The detailed format of the registration request is as follows:")]),t._v(" "),a("p",[a("strong",[t._v("Registration request:")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('    URL: http://127.0.0.1:8991/jt808/registry\n    Method: POST\n    Body:\n       {"province": 58,\n         "city": 59,\n         "manufacturer": "Infinity",\n         "model": "Q2",\n         "license_number": "ZA334455",\n         "dev_id": "xx11344",\n         "color": 3,\n         "phone", "00123456789"\n       }\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[a("strong",[t._v("Registration Response:")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "code": 0,\n  "authcode": "132456789"\n}\n\nor:\n\n{\n  "code": 1\n}\n\nThe return code can be:\n\n0: success\n1: The vehicle has been registered\n2: The vehicle is not in the database\n3: The terminal has been registered\n4: There is no such terminal in the database\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("p",[a("strong",[t._v("Authentication request:")])]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    URL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("http://127.0.0.1:8991/jt808/auth")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    Method")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("POST")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("    Body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('       {"code"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"authcode",')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v('         "phone",')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v('"00123456789"')]),t._v("\n       }\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[a("strong",[t._v("Authentication response:")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("HTTP status code 200: authentication succeeded\nOther: Authentication failed\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tip")]),t._v(" "),a("p",[t._v("The authentication request is only called when the system does not save the authentication code (that is, the terminal directly sends an authentication message to log in to the system)")])]),t._v(" "),a("h3",{attrs:{id:"data-uplink-and-downlink"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-uplink-and-downlink"}},[t._v("#")]),t._v(" Data uplink and downlink")]),t._v(" "),a("p",[t._v("In emqx-jt808, you can send and receive terminal messages by configuring uplink and downlink topics:")]),t._v(" "),a("h4",{attrs:{id:"upward"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#upward"}},[t._v("#")]),t._v(" Upward")]),t._v(" "),a("p",[t._v("For example: "),a("strong",[t._v("Manufacturer Id")]),t._v(" is ʻabcde"),a("code",[t._v("and **Terminal Id** is")]),t._v("1234567`.")]),t._v(" "),a("p",[t._v("First use the MQTT client to subscribe to the topic "),a("code",[t._v("jt808/abcde1234567/up")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("$")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("mosquitto_sub -t jt808/abcde1234567/up")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("For example, after the terminal reports a message of type "),a("code",[t._v("Data Uplink Transparent Transmission (0x0900)")]),t._v(", the subscriber will receive:")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"body"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MTIzNDU2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("240")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"header"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"encrypt"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"len"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msg_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"msg_sn"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"phone"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"011111111111"')]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tip")]),t._v(" "),a("p",[t._v("For transparent transmission, the content of the data field will be base64 encoded and reported once")])]),t._v(" "),a("h4",{attrs:{id:"data-downlink"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-downlink"}},[t._v("#")]),t._v(" Data Downlink")]),t._v(" "),a("p",[t._v("Similarly, take the ID in the above row as an example; after the terminal is successfully authenticated, use the MQTT client to send a message of the type'data downlink transparent transmission (0x8900)' to the terminal:")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('$ mosquitto_pub -t jt808/abcde1234567/dn -m\'{"body":{"data":"MTIzNDU2","type":240},"header":{"msg_id":35072}}\'\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tip")]),t._v(" "),a("p",[t._v("In the downstream JSON, the content in the header only needs to have msg_id; the content in the body has different structures according to different msg_id")])])])}),[],!1,null,null,null);s.default=n.exports},391:function(t,s,e){t.exports=e.p+"docs-assets/img/modules.1814040c.png"},561:function(t,s,e){t.exports=e.p+"docs-assets/img/proto_jt8081.0a06969e.png"},562:function(t,s,e){t.exports=e.p+"docs-assets/img/proto_jt8082.a654d455.png"},563:function(t,s,e){t.exports=e.p+"docs-assets/img/proto_jt8083.ee561e95.png"},564:function(t,s,e){t.exports=e.p+"docs-assets/img/proto_jt8084.8dfc2318.png"},565:function(t,s,e){t.exports=e.p+"docs-assets/img/proto_jt8085.0398aeb3.png"},566:function(t,s,e){t.exports=e.p+"docs-assets/img/proto_jt8086.6cd60e01.png"}}]);