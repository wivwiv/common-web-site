(window.webpackJsonp=window.webpackJsonp||[]).push([[86],{1127:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_tcp1.12a070db.png"},1128:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_tcp2.bc3c8c15.png"},1129:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_tcp3.93d418bc.png"},1130:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_tcp4.46c1f865.png"},1131:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_tcp5.7d0edc87.png"},1132:function(s,t,a){s.exports=a.p+"docs-assets/img/proto_tcp6.672a701d.png"},1790:function(s,t,a){"use strict";a.r(t);var r=a(10),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"tcp-协议网关"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#tcp-协议网关"}},[s._v("#")]),s._v(" TCP 协议网关")]),s._v(" "),r("h2",{attrs:{id:"协议介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#协议介绍"}},[s._v("#")]),s._v(" 协议介绍")]),s._v(" "),r("p",[s._v("EMQX 提供 "),r("strong",[s._v("emqx-tcp")]),s._v(" 模块作为一个靠近端侧的一个接入模块，按照其功能逻辑和整个系统的关系，将整个消息交换的过程可以分成三个部分：终端侧，平台侧和其它侧：")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-- Terminal --"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("--------- Broker Side ---------"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("---  Others  ---"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-    Sid e   -"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),s._v("                                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("--    Side    --"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),s._v("\n\n+---+                                                PUB  +-----------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" D "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  INCOMING  +----------+    PUB     +---------+   --"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),s._v(" subscriber"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" E "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-----------"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-----------"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("--/   +-----------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" V "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" emqx-tcp "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  EMQX  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" I "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-----------"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-----------"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("--   +-----------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" C "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  OUTGOING  +----------+    PUB     +---------+   "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("--"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" publisher "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" E "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                                PUB  +-----------+\n+---+\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("ol",[r("li",[s._v("终端侧，通过本模块定义的 TCP 私有协议进行接入，然后实现数据的上报，或者接收下行的消息。")]),s._v(" "),r("li",[s._v("平台侧，主体是 emqx-tcp 模块和  EMQX 系统。emqx-tcp 负责报文的编解码，代理订阅下行主题。实现将上行消息转为 EMQX 系统中的 MQTT 消息 PUBLISH 到整个系统中；将下行的 MQTT 消息转化为 TCP 私有协议的报文结构，下发到终端。")]),s._v(" "),r("li",[s._v("其它侧，可以对 2 中出现的上行的 PUBLISH 消息的主题进行订阅，以接收上行消息。或对发布消息到具体的下行的主题，以发送数据到终端侧。")])]),s._v(" "),r("h2",{attrs:{id:"创建模块"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建模块"}},[s._v("#")]),s._v(" 创建模块")]),s._v(" "),r("p",[s._v("打开 "),r("a",{attrs:{href:"http://127.0.0.1:18083/#/modules",target:"_blank",rel:"noopener noreferrer"}},[s._v("EMQX Dashboard"),r("OutboundLink")],1),s._v("，点击左侧的 “模块” 选项卡，选择添加：")]),s._v(" "),r("p",[r("img",{attrs:{src:a(390),alt:"image-20200927213049265"}})]),s._v(" "),r("p",[s._v("选择 TCP 私有协议接入网关:")]),s._v(" "),r("p",[r("img",{attrs:{src:a(1127),alt:"image-20200927213049265"}})]),s._v(" "),r("p",[s._v("配置相关基础参数:")]),s._v(" "),r("p",[r("img",{attrs:{src:a(1128),alt:"image-20200927213049265"}})]),s._v(" "),r("p",[s._v("添加监听端口:")]),s._v(" "),r("p",[r("img",{attrs:{src:a(1129),alt:"image-20200927213049265"}})]),s._v(" "),r("p",[s._v("配置监听参数:")]),s._v(" "),r("p",[r("img",{attrs:{src:a(1130),alt:"image-20200927213049265"}})]),s._v(" "),r("p",[s._v("点击确认到配置参数页面:")]),s._v(" "),r("p",[r("img",{attrs:{src:a(1131),alt:"image-20200927213049265"}})]),s._v(" "),r("p",[s._v("点击添加后，模块添加完成:\n"),r("img",{attrs:{src:a(1132),alt:"image-20200927213049265"}})]),s._v(" "),r("h3",{attrs:{id:"配置参数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置参数"}},[s._v("#")]),s._v(" 配置参数")]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",[s._v("配置项")]),s._v(" "),r("th",[s._v("说明")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[s._v("空闲超时时间")]),s._v(" "),r("td",[s._v("闲置时间。超过该时间未收到 CONNECT 帧, 将直接关闭该 TCP 连接")])]),s._v(" "),r("tr",[r("td",[s._v("上行主题")]),s._v(" "),r("td",[s._v("上行主题。上行消息到 EMQ 系统中的消息主题%c: 接入客户端的 ClientId,%u: 接入客户端的 Username")])]),s._v(" "),r("tr",[r("td",[s._v("下行主题")]),s._v(" "),r("td",[s._v("下行主题。上行消息到 EMQ 系统中的消息主题%c: 接入客户端的 ClientId,%u: 接入客户端的 Username")])]),s._v(" "),r("tr",[r("td",[s._v("报文最大长度")]),s._v(" "),r("td",[s._v("最大处理的单个 TCP 私有协议报文大小")])]),s._v(" "),r("tr",[r("td",[s._v("强制 GC 策略")]),s._v(" "),r("td",[s._v("强制 GC, 当进程已处理 1000 消息或发送数据超过 1M")])]),s._v(" "),r("tr",[r("td",[s._v("强制关闭策略")]),s._v(" "),r("td",[s._v("强制关闭连接, 当进程堆积 8000 消息或堆栈内存超过 800M")])])])]),s._v(" "),r("h2",{attrs:{id:"私有-tcp-协议-v1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#私有-tcp-协议-v1"}},[s._v("#")]),s._v(" 私有 TCP 协议 - v1")]),s._v(" "),r("h3",{attrs:{id:"设计准则"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#设计准则"}},[s._v("#")]),s._v(" 设计准则")]),s._v(" "),r("p",[s._v("私有 TCP 协议的设计原则有三:")]),s._v(" "),r("ol",[r("li",[r("strong",[s._v("轻量")]),s._v(": 尽量减少头部、控制字段的字节大小")]),s._v(" "),r("li",[r("strong",[s._v("简洁")]),s._v(": 私有 TCP 协议，主要功能定位在透传上层应用/协议的数据报文。所以功能应当简洁，专注透明传输即可")]),s._v(" "),r("li",[r("strong",[s._v("可靠")]),s._v(": 保证消息有序可达")])]),s._v(" "),r("h3",{attrs:{id:"报文结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#报文结构"}},[s._v("#")]),s._v(" 报文结构")]),s._v(" "),r("p",[s._v("报文主要有俩部分构成: "),r("strong",[s._v("固定头部(FixedHeader)")]),s._v(" + "),r("strong",[s._v("有效载荷(Payload)")])]),s._v(" "),r("p",[s._v("其中固定头部固定 1 字节；有效载荷为变长，且前面有 2 个字节标识整个 Payload 的长度:")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("         "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Byte         "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" Bytes        N Bytes\n    +--------------+----------------+--------------+\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Fixed Header "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Len of Payload "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  Payload     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    +--------------+----------------+--------------+\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[r("strong",[s._v("部分类型报文中不含 Payload; 则整个报文仅只有 1 个字节的固定头部")])]),s._v(" "),r("h4",{attrs:{id:"数据类型"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#数据类型"}},[s._v("#")]),s._v(" 数据类型")]),s._v(" "),r("p",[s._v("本协议设计到的数据类型")]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",[s._v("Name")]),s._v(" "),r("th",[s._v("Bytes")]),s._v(" "),r("th",[s._v("Description")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[s._v("UINT(x)")]),s._v(" "),r("td",[s._v("x")]),s._v(" "),r("td",[s._v("固定 x 字节的 无符号整型")])]),s._v(" "),r("tr",[r("td",[s._v("BIN(n)")]),s._v(" "),r("td",[s._v("变长")]),s._v(" "),r("td",[s._v("带 2 字节标示长度的变长二进制。n 取值为 0 到 65535 "),r("strong",[s._v("内容为空时，需使用 2 个字节，来标识长度值0")])])]),s._v(" "),r("tr",[r("td",[s._v("STR(n)")]),s._v(" "),r("td",[s._v("变长")]),s._v(" "),r("td",[s._v("带 2 字节标示长度的变长字符串。n 取值为 0 到 65535; 空串表达方式同上。")])]),s._v(" "),r("tr",[r("td",[s._v("BIN")]),s._v(" "),r("td",[s._v("_")]),s._v(" "),r("td",[s._v("不带长度标识的二进制串")])])])]),s._v(" "),r("h4",{attrs:{id:"固定头部"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#固定头部"}},[s._v("#")]),s._v(" 固定头部")]),s._v(" "),r("p",[s._v("固定头部有俩部分组成:  "),r("strong",[s._v("帧类型")]),s._v("、"),r("strong",[s._v("标志位")])]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("       "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    +------------------------------------------+\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" Bits        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" Bits       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n    +------------------------------------------+\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("--   Frame Type   --"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("--    Flags    --"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">|")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("p",[r("strong",[s._v("帧类型(Frame Type)")]),s._v(" 有以下几种可选值")]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",[s._v("Name")]),s._v(" "),r("th",[s._v("Value")]),s._v(" "),r("th",[s._v("Direction of Flow")]),s._v(" "),r("th",[s._v("Description")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[s._v("CONNECT")]),s._v(" "),r("td",[s._v("1")]),s._v(" "),r("td",[s._v("Client --\x3e Server")]),s._v(" "),r("td",[s._v("连接报文")])]),s._v(" "),r("tr",[r("td",[s._v("CONNACK")]),s._v(" "),r("td",[s._v("2")]),s._v(" "),r("td",[s._v("Server --\x3e Client")]),s._v(" "),r("td",[s._v("连接应答")])]),s._v(" "),r("tr",[r("td",[s._v("DATATRANS")]),s._v(" "),r("td",[s._v("3")]),s._v(" "),r("td",[s._v("Client <==> Server")]),s._v(" "),r("td",[s._v("透明传输")])]),s._v(" "),r("tr",[r("td",[s._v("PING")]),s._v(" "),r("td",[s._v("4")]),s._v(" "),r("td",[s._v("Client --\x3e Server")]),s._v(" "),r("td",[s._v("心跳报文")])]),s._v(" "),r("tr",[r("td",[s._v("PONG")]),s._v(" "),r("td",[s._v("5")]),s._v(" "),r("td",[s._v("Server --\x3e Client")]),s._v(" "),r("td",[s._v("心跳应答")])]),s._v(" "),r("tr",[r("td",[s._v("DISCONNECT")]),s._v(" "),r("td",[s._v("6")]),s._v(" "),r("td",[s._v("Client --\x3e Server")]),s._v(" "),r("td",[s._v("主动断开连接")])]),s._v(" "),r("tr",[r("td",[s._v("Reserved")]),s._v(" "),r("td",[s._v("7-15")]),s._v(" "),r("td",[s._v("保留")]),s._v(" "),r("td",[s._v("保留字段")])])])]),s._v(" "),r("p",[r("strong",[s._v("标志位(Flags)")]),s._v(" 针对每个类型的报文，标志位代表的含义都不相同。")]),s._v(" "),r("h3",{attrs:{id:"报文详解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#报文详解"}},[s._v("#")]),s._v(" 报文详解")]),s._v(" "),r("h4",{attrs:{id:"connect-帧"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#connect-帧"}},[s._v("#")]),s._v(" CONNECT 帧")]),s._v(" "),r("p",[s._v("连接报文. "),r("strong",[s._v("帧类型为 2#0001")]),s._v(". 标志位 4 Bits 代表协议 "),r("strong",[s._v("版本号(Version)")]),s._v(" 目前为 1 即 2#0001。因此 CONNECT 帧固定头部为 "),r("strong",[s._v("0x11")])]),s._v(" "),r("p",[s._v("而，Payload 中包含连接用的所有字段。则必须按照以下顺序给出，否则为非法报文，立即断开 TCP 链接：")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    Len       Keepalive"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ClientId"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("x"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  Username  Password\n    UINT"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   UINT"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("      STR"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       STR"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    STR"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("p",[s._v("其中 Keepalive 和 ClientId 为必填字段；Username 与 Password 可不带。")]),s._v(" "),r("p",[s._v("因此，一个 Keepalive 为 60; ClientId 为 'abcd'; Username 和 Password 均为空时，报文的内容为:")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    0x11 00 07 3c 00 04 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("若是 Username 和 Password 不为空且假设都为 'abcd' 的情况下，报文内容为:")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    0x11 00 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" 3c 00 04 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" 00 04 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" 00 04 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h4",{attrs:{id:"connack-帧"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#connack-帧"}},[s._v("#")]),s._v(" CONNACK 帧")]),s._v(" "),r("p",[s._v("连接应答报文. "),r("strong",[s._v("帧类型为 2#0010")]),s._v(". 标志位 4 Bits 为应答连接结果(ACK Code)。可以为以下枚举值：")]),s._v(" "),r("table",[r("thead",[r("tr",[r("th",[s._v("Name")]),s._v(" "),r("th",[s._v("Value")]),s._v(" "),r("th",[s._v("Description")])])]),s._v(" "),r("tbody",[r("tr",[r("td",[s._v("SUCCESSFUL")]),s._v(" "),r("td",[s._v("0")]),s._v(" "),r("td",[s._v("连接成功")])]),s._v(" "),r("tr",[r("td",[s._v("AUTHFAILED")]),s._v(" "),r("td",[s._v("1")]),s._v(" "),r("td",[s._v("认证失败")])]),s._v(" "),r("tr",[r("td",[s._v("ILLEGALVER")]),s._v(" "),r("td",[s._v("2")]),s._v(" "),r("td",[s._v("不支持的协议版本")])]),s._v(" "),r("tr",[r("td",[s._v("Reserved")]),s._v(" "),r("td",[s._v("3-15")]),s._v(" "),r("td",[s._v("保留字段")])])])]),s._v(" "),r("p",[s._v("而，Payload 字段，为连接应答后传递的 "),r("strong",[s._v("Message")]),s._v("; 该串可为空串。")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("Message\nSTR"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("p",[s._v("所以，当连接成功时，并返回 "),r("code",[s._v("Connect Sucessfully")]),s._v(" 时，报文内容为:")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    0x20 00 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(" 6f 6e 6e "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v(" 6c 6c "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("79")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[s._v("若是，返回 "),r("code",[s._v("认证失败")]),s._v(" 且 Message 为空时::")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    0x21 00 00\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h4",{attrs:{id:"datatrans-帧"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#datatrans-帧"}},[s._v("#")]),s._v(" DATATRANS 帧")]),s._v(" "),r("p",[s._v("数据传输帧. "),r("strong",[s._v("帧类型为 2#0011")]),s._v(". 标志位 前 2 Bits 表达 "),r("strong",[s._v("消息质量等级(Qos)")]),s._v(" 目前恒为0；后两位为保留位。所以DATATRANS "),r("strong",[s._v("帧固定头部恒为 0x30")])]),s._v(" "),r("p",[s._v("Payload 内容为为透传的 "),r("strong",[s._v("数据字段")])]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("Len     Payload\nUINT"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" BIN\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("p",[s._v("注：由于 Len 固定为 2 字节，所以最大仅支持 65535 字节的负载。")]),s._v(" "),r("p",[s._v("因此，如果透传 "),r("code",[s._v("abcd")]),s._v(" 这个字符串时，该报文的内容为:")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    0x30 00 04 "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v("\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h4",{attrs:{id:"ping-帧"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#ping-帧"}},[s._v("#")]),s._v(" PING 帧")]),s._v(" "),r("p",[s._v("心跳帧. "),r("strong",[s._v("帧类型为 2#0100")]),s._v(". 标志位 Flags 固定为 0。即固定头部 "),r("strong",[s._v("固定为：0x40")])]),s._v(" "),r("p",[s._v("Payload 为空")]),s._v(" "),r("p",[s._v("因此，一个 PING 帧仅有一个字节:")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    0x40\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h4",{attrs:{id:"pong-帧"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#pong-帧"}},[s._v("#")]),s._v(" PONG 帧")]),s._v(" "),r("p",[s._v("心跳应答帧. "),r("strong",[s._v("帧类型为 2#0101")]),s._v(". 标志位 Flags 固定为 0。即固定头部 "),r("strong",[s._v("固定为：0x50")])]),s._v(" "),r("p",[s._v("Payload 为空")]),s._v(" "),r("p",[s._v("因此，一个 PONG 帧仅有一个字节:")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    0x50\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h4",{attrs:{id:"disconnect-帧"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#disconnect-帧"}},[s._v("#")]),s._v(" DISCONNECT 帧")]),s._v(" "),r("p",[s._v("断开连接帧. "),r("strong",[s._v("帧类型为 2#0111")]),s._v(". Flags 为空。即固定头部 "),r("strong",[s._v("固定为：0x60")])]),s._v(" "),r("p",[s._v("Payload 为空")]),s._v(" "),r("p",[s._v("因此，DISCONNECT 帧仅有 1 个字节:")]),s._v(" "),r("div",{staticClass:"language-bash line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[s._v("    0x60\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])])])}),[],!1,null,null,null);t.default=e.exports},390:function(s,t,a){s.exports=a.p+"docs-assets/img/modules.89e07c9c.png"}}]);